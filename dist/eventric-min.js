!function(){"use strict";var t="undefined"==typeof window?global:window;if("function"!=typeof t.require){var n={},e={_load:function(t,r){var i=e._resolveFilename(t,r),s=n[i];if(!s)throw new Error('Cannot find module "'+i+'" from "'+r+'"');if(e._cache[i])return e._cache[i].exports;var u=o(i),a={id:i,exports:{}};return e._cache[i]=a,s.call(a.exports,a.exports,u,a),a.exports},_cache:{},_resolveFilename:function(t,e){var r=i(s(e),t);return n.hasOwnProperty(r)?r:(r=i(r,"./index"),n.hasOwnProperty(r)?r:t)}},r=function(t,n){return e._load(t,n)},i=function(){var t=/^\.\.?(\/|$)/;return function(n,e){var r,i,o=[];r=(t.test(e)?n+"/"+e:e).split("/");for(var s=0,u=r.length;u>s;s++)i=r[s],".."===i?o.pop():"."!==i&&""!==i&&o.push(i);return o.join("/")}}(),o=function(n){return function(e){return t.require(e,n)}},s=function(t){return t?t.split("/").slice(0,-1).join("/"):""};r.register=r.define=function(t,e){if("object"==typeof t)for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);else n[t]=e},r.list=function(){var t=[];for(var e in n)n.hasOwnProperty(e)&&t.push(e);return t},t.require=r,r.define("module",function(t,n,r){r.exports=e})}}(),require.register("eventric/eventric",function(t,n,e){var r,i=function(t,n){return function(){return t.apply(n,arguments)}},o=[].slice;r=function(){function t(){this._handleRemoteRPCRequest=i(this._handleRemoteRPCRequest,this),this.PubSub=n("./pub_sub"),this.EventBus=n("./event_bus"),this.Remote=n("./remote"),this.Context=n("./context"),this.DomainEvent=n("./domain_event"),this.Aggregate=n("./aggregate"),this.Repository=n("./repository"),this.Projection=n("./projection"),this.ProcessManager=n("./process_manager"),this.Logger=n("./logger"),this.RemoteInMemory=n("./remote/inmemory"),this.StoreInMemory=n("./store/inmemory"),this.log=this.Logger,this.projectionService=new this.Projection(this),this._contexts={},this._params={},this._processManagerInstances={},this._processManagerService=this.ProcessManager,this._domainEventHandlers={},this._domainEventHandlersAll=[],this._storeClasses={},this._remoteEndpoints=[],this.addRemoteEndpoint("inmemory",this.RemoteInMemory.endpoint),this.addStore("inmemory",this.StoreInMemory),this.set("default domain events store","inmemory")}return t.prototype.set=function(t,n){return this._params[t]=n},t.prototype.get=function(t){return t?this._params[t]:this._params},t.prototype.addStore=function(t,n,e){return null==e&&(e={}),this._storeClasses[t]={Class:n,options:e}},t.prototype.getStores=function(){return this._storeClasses},t.prototype.context=function(t){var n,e,r;if(!t)throw e="Contexts must have a name",this.log.error(e),new Error(e);return r=new this.PubSub,n=new this.Context(t,this),this.mixin(n,r),this._delegateAllDomainEventsToGlobalHandlers(n),this._delegateAllDomainEventsToRemoteEndpoints(n),this._contexts[t]=n,n},t.prototype.getContext=function(t){return this._contexts[t]},t.prototype.remote=function(t){var n,e,r;if(!t)throw n="Missing context name",this.log.error(n),new Error(n);return e=new this.PubSub,r=new this.Remote(t,this),this.mixin(r,e),r},t.prototype.addRemoteEndpoint=function(t,n){return this._remoteEndpoints.push(n),n.setRPCHandler(this._handleRemoteRPCRequest)},t.prototype._handleRemoteRPCRequest=function(t,n){var e,r;return e=this.getContext(t.contextName),e?t.method in e?e[t.method].apply(e,t.params).then(function(t){return n(null,t)})["catch"](function(t){return n(t)}):(r="Remote RPC method "+t.method+" not found on Context "+t.contextName,this.log.error(r),n(r,null)):(r="Tried to handle Remote RPC with not registered context "+t.contextName,this.log.error(r),n(r,null))},t.prototype._delegateAllDomainEventsToGlobalHandlers=function(t){return t.subscribeToAllDomainEvents(function(n){return function(e){var r,i,o,s,u;for(i=n.getDomainEventHandlers(t.name,e.name),u=[],o=0,s=i.length;s>o;o++)r=i[o],u.push(r(e));return u}}(this))},t.prototype._delegateAllDomainEventsToRemoteEndpoints=function(t){return t.subscribeToAllDomainEvents(function(n){return function(e){return n._remoteEndpoints.forEach(function(n){return n.publish(t.name,e.name,e),e.aggregate?n.publish(t.name,e.name,e.aggregate.id,e):void 0})}}(this))},t.prototype.subscribeToDomainEvent=function(){var t,n,e,r,i,s,u;return r=2<=arguments.length?o.call(arguments,0,u=arguments.length-1):(u=0,[]),n=arguments[u++],t=r[0],e=r[1],null==t&&(t="all"),null==e&&(e="all"),"all"===t&&"all"===e?this._domainEventHandlersAll.push(n):(null==(i=this._domainEventHandlers)[t]&&(i[t]={}),null==(s=this._domainEventHandlers[t])[e]&&(s[e]=[]),this._domainEventHandlers[t][e].push(n))},t.prototype.getDomainEventHandlers=function(t,n){var e,r,i,o,s;return[].concat(null!=(e=null!=(r=this._domainEventHandlers[t])?r[n]:void 0)?e:[],null!=(i=null!=(o=this._domainEventHandlers[t])?o.all:void 0)?i:[],null!=(s=this._domainEventHandlersAll)?s:[])},t.prototype.generateUid=function(t){var n,e;return n=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},e=t||"-",n()+n()+e+n()+e+n()+e+n()+e+n()+n()+n()},t.prototype.addProcessManager=function(t,n){return this._processManagerService.add(t,n,this)},t.prototype.nextTick=function(t){var n,e;return(n=null!=(e="undefined"!=typeof process&&null!==process?process.nextTick:void 0)?e:setTimeout)(function(){return t()})},t.prototype.defaults=function(t,n){var e,r,i,o;for(e=[].concat(Object.keys(t),Object.keys(n)),i=0,o=e.length;o>i;i++)r=e[i],!t[r]&&n[r]&&(t[r]=n[r]);return t},t.prototype.eachSeries=function(t,n,e){var r,i;return e=e||function(){},Array.isArray(t)&&t.length?(r=0,(i=function(){n(t[r],function(n){n?(e(n),e=function(){}):(++r,r>=t.length?e():i())})})()):e()},t.prototype.mixin=function(t,n){var e,r;r=[];for(e in n)r.push(t[e]=n[e]);return r},t}(),e.exports=r}),require.register("es6-promise",function(){!function(){var t,n,e,r;!function(){var i={},o={};t=function(t,n,e){i[t]={deps:n,callback:e}},r=e=n=function(t){function e(n){if("."!==n.charAt(0))return n;for(var e=n.split("/"),r=t.split("/").slice(0,-1),i=0,o=e.length;o>i;i++){var s=e[i];if(".."===s)r.pop();else{if("."===s)continue;r.push(s)}}return r.join("/")}if(r._eak_seen=i,o[t])return o[t];if(o[t]={},!i[t])throw new Error("Could not find module "+t);for(var s,u=i[t],a=u.deps,c=u.callback,l=[],p=0,f=a.length;f>p;p++)l.push("exports"===a[p]?s={}:n(e(a[p])));var m=c.apply(this,l);return o[t]=s||m}}(),t("promise/all",["./utils","exports"],function(t,n){"use strict";function e(t){var n=this;if(!r(t))throw new TypeError("You must pass an array to all.");return new n(function(n,e){function r(t){return function(n){o(t,n)}}function o(t,e){u[t]=e,0===--a&&n(u)}var s,u=[],a=t.length;0===a&&n([]);for(var c=0;c<t.length;c++)s=t[c],s&&i(s.then)?s.then(r(c),e):o(c,s)})}var r=t.isArray,i=t.isFunction;n.all=e}),t("promise/asap",["exports"],function(t){"use strict";function n(){return function(){process.nextTick(i)}}function e(){var t=0,n=new a(i),e=document.createTextNode("");return n.observe(e,{characterData:!0}),function(){e.data=t=++t%2}}function r(){return function(){c.setTimeout(i,1)}}function i(){for(var t=0;t<l.length;t++){var n=l[t],e=n[0],r=n[1];e(r)}l=[]}function o(t,n){var e=l.push([t,n]);1===e&&s()}var s,u="undefined"!=typeof window?window:{},a=u.MutationObserver||u.WebKitMutationObserver,c="undefined"!=typeof global?global:void 0===this?window:this,l=[];s="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?n():a?e():r(),t.asap=o}),t("promise/config",["exports"],function(t){"use strict";function n(t,n){return 2!==arguments.length?e[t]:void(e[t]=n)}var e={instrument:!1};t.config=e,t.configure=n}),t("promise/polyfill",["./promise","./utils","exports"],function(t,n,e){"use strict";function r(){var t;t="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;var n="Promise"in t&&"resolve"in t.Promise&&"reject"in t.Promise&&"all"in t.Promise&&"race"in t.Promise&&function(){var n;return new t.Promise(function(t){n=t}),o(n)}();n||(t.Promise=i)}var i=t.Promise,o=n.isFunction;e.polyfill=r}),t("promise/promise",["./config","./utils","./all","./race","./resolve","./reject","./asap","exports"],function(t,n,e,r,i,o,s,u){"use strict";function a(t){if(!E(t))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof a))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],c(t,this)}function c(t,n){function e(t){h(n,t)}function r(t){d(n,t)}try{t(e,r)}catch(i){r(i)}}function l(t,n,e,r){var i,o,s,u,a=E(e);if(a)try{i=e(r),s=!0}catch(c){u=!0,o=c}else i=r,s=!0;m(n,i)||(a&&s?h(n,i):u?d(n,o):t===I?h(n,i):t===C&&d(n,i))}function p(t,n,e,r){var i=t._subscribers,o=i.length;i[o]=n,i[o+I]=e,i[o+C]=r}function f(t,n){for(var e,r,i=t._subscribers,o=t._detail,s=0;s<i.length;s+=3)e=i[s],r=i[s+n],l(n,e,r,o);t._subscribers=null}function m(t,n){var e,r=null;try{if(t===n)throw new TypeError("A promises callback cannot return that same promise.");if(b(n)&&(r=n.then,E(r)))return r.call(n,function(r){return e?!0:(e=!0,void(n!==r?h(t,r):g(t,r)))},function(n){return e?!0:(e=!0,void d(t,n))}),!0}catch(i){return e?!0:(d(t,i),!0)}return!1}function h(t,n){t===n?g(t,n):m(t,n)||g(t,n)}function g(t,n){t._state===S&&(t._state=A,t._detail=n,y.async(v,t))}function d(t,n){t._state===S&&(t._state=A,t._detail=n,y.async(_,t))}function v(t){f(t,t._state=I)}function _(t){f(t,t._state=C)}var y=t.config,b=(t.configure,n.objectOrFunction),E=n.isFunction,D=(n.now,e.all),x=r.race,P=i.resolve,w=o.reject,j=s.asap;y.async=j;var S=void 0,A=0,I=1,C=2;a.prototype={constructor:a,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(t,n){var e=this,r=new this.constructor(function(){});if(this._state){var i=arguments;y.async(function(){l(e._state,r,i[e._state-1],e._detail)})}else p(this,r,t,n);return r},"catch":function(t){return this.then(null,t)}},a.all=D,a.race=x,a.resolve=P,a.reject=w,u.Promise=a}),t("promise/race",["./utils","exports"],function(t,n){"use strict";function e(t){var n=this;if(!r(t))throw new TypeError("You must pass an array to race.");return new n(function(n,e){for(var r,i=0;i<t.length;i++)r=t[i],r&&"function"==typeof r.then?r.then(n,e):n(r)})}var r=t.isArray;n.race=e}),t("promise/reject",["exports"],function(t){"use strict";function n(t){var n=this;return new n(function(n,e){e(t)})}t.reject=n}),t("promise/resolve",["exports"],function(t){"use strict";function n(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var n=this;return new n(function(n){n(t)})}t.resolve=n}),t("promise/utils",["exports"],function(t){"use strict";function n(t){return e(t)||"object"==typeof t&&null!==t}function e(t){return"function"==typeof t}function r(t){return"[object Array]"===Object.prototype.toString.call(t)}var i=Date.now||function(){return(new Date).getTime()};t.objectOrFunction=n,t.isFunction=e,t.isArray=r,t.now=i}),n("promise/polyfill").polyfill()}()}),require.register("eventric/index",function(t,n,e){var r,i;i=n("es6-promise"),"undefined"!=typeof e&&"undefined"!=typeof process&&(global.Promise=i.Promise),r=n("./eventric"),e.exports=new r}),require.register("eventric/logger",function(t,n,e){e.exports={_logLevel:1,setLogLevel:function(t){return this._logLevel=function(){switch(t){case"debug":return 0;case"warn":return 1;case"info":return 2;case"error":return 3}}()},debug:function(){return this._logLevel>0?void 0:console.log.apply(console,arguments)},warn:function(){return this._logLevel>1?void 0:console.log.apply(console,arguments)},info:function(){return this._logLevel>2?void 0:console.log.apply(console,arguments)},error:function(){return this._logLevel>3?void 0:console.log.apply(console,arguments)}}}),require.register("eventric/aggregate/aggregate",function(t,n,e){var r,i=function(t,n){return function(){return t.apply(n,arguments)}},o=[].slice;r=function(){function t(t,n,e,r){this._context=t,this._eventric=n,this._name=e,this.create=i(this.create,this),this.getDomainEvents=i(this.getDomainEvents,this),this.emitDomainEvent=i(this.emitDomainEvent,this),this._domainEvents=[],this.root=r?new r:{},this.root.$emitDomainEvent=this.emitDomainEvent}return t.prototype.emitDomainEvent=function(t,n){var e,r,i;if(e=this._context.getDomainEvent(t),!e)throw i="Tried to emitDomainEvent '"+t+"' which is not defined",this._eventric.log.error(i),new Error(i);return r=this._createDomainEvent(t,e,n),this._domainEvents.push(r),this._handleDomainEvent(t,r),this._eventric.log.debug("Created and Handled DomainEvent in Aggregate",r)},t.prototype._createDomainEvent=function(t,n,e){return new this._eventric.DomainEvent({id:this._eventric.generateUid(),name:t,aggregate:{id:this.id,name:this._name},context:this._context.name,payload:new n(e)})},t.prototype._handleDomainEvent=function(t,n){return this.root["handle"+t]?this.root["handle"+t](n,function(){}):this._eventric.log.debug("Tried to handle the DomainEvent '"+t+"' without a matching handle method")},t.prototype.getDomainEvents=function(){return this._domainEvents},t.prototype.applyDomainEvents=function(t){var n,e,r,i;for(i=[],e=0,r=t.length;r>e;e++)n=t[e],i.push(this._applyDomainEvent(n));return i},t.prototype._applyDomainEvent=function(t){return this._handleDomainEvent(t.name,t)},t.prototype.create=function(){var t;return t=arguments,new Promise(function(n){return function(e,r){var i,s,u,a;if(n.id=n._eventric.generateUid(),"function"!=typeof n.root.create)throw u="No create function on aggregate",n._eventric.log.error(u),new Error(u);try{if(i=(a=n.root).create.apply(a,o.call(t).concat([function(t){return t?r(t):e(n)}])),i instanceof Promise)return i.then(function(){return e(n)}),i["catch"](function(t){return r(t)})}catch(c){return s=c,r(s)}}}(this))},t}(),e.exports=r}),require.register("eventric/aggregate/index",function(t,n,e){e.exports=n("./aggregate")}),require.register("eventric/context/context",function(t,n,e){var r,i=function(t,n){return function(){return t.apply(n,arguments)}},o=[].slice;r=function(){function t(t,n){this.name=t,this._eventric=n,this.clearProjectionStore=i(this.clearProjectionStore,this),this.getProjectionStore=i(this.getProjectionStore,this),this._getAggregateRepository=i(this._getAggregateRepository,this),this.publishDomainEvent=i(this.publishDomainEvent,this),this.emitDomainEvent=i(this.emitDomainEvent,this),this._initialized=!1,this._params=this._eventric.get(),this._di={},this._aggregateRootClasses={},this._adapterClasses={},this._adapterInstances={},this._commandHandlers={},this._queryHandlers={},this._domainEventClasses={},this._domainEventHandlers={},this._projectionClasses={},this._domainEventStreamClasses={},this._domainEventStreamInstances={},this._repositoryInstances={},this._domainServices={},this._storeClasses={},this._storeInstances={},this._eventBus=new this._eventric.EventBus(this._eventric),this.projectionService=this._eventric.projectionService,this.log=this._eventric.log}return t.prototype.set=function(t,n){return this._params[t]=n,this},t.prototype.get=function(t){return this._params[t]},t.prototype.emitDomainEvent=function(t,n){var e,r;if(e=this.getDomainEvent(t),!e)throw new Error("Tried to emitDomainEvent '"+t+"' which is not defined");return r=this._createDomainEvent(t,e,n),this.getDomainEventsStore().saveDomainEvent(r,function(t){return function(){return t.publishDomainEvent(r)}}(this))},t.prototype.publishDomainEvent=function(t){return this._eventBus.publishDomainEvent(t)},t.prototype._createDomainEvent=function(t,n,e){return new this._eventric.DomainEvent({id:this._eventric.generateUid(),name:t,context:this.name,payload:new n(e)})},t.prototype.addStore=function(t,n,e){return null==e&&(e={}),this._storeClasses[t]={Class:n,options:e},this},t.prototype.defineDomainEvent=function(t,n){return this._domainEventClasses[t]=n,this},t.prototype.defineDomainEvents=function(t){var n,e;for(e in t)n=t[e],this.defineDomainEvent(e,n);return this},t.prototype.addCommandHandler=function(t,n){return this._commandHandlers[t]=function(e){return function(){var r,i,s,u,a,c;r={id:e._eventric.generateUid(),name:t,params:null!=(a=arguments[0])?a:null},u={},c=e._di;for(s in c)i=c[s],u[s]=i;return u.$aggregate={create:function(){var t,n,i;return t=arguments[0],n=2<=arguments.length?o.call(arguments,1):[],i=e._getAggregateRepository(t,r),i.create.apply(i,n)},load:function(t,n){var i;return i=e._getAggregateRepository(t,r),i.findById(n)}},n.apply(u,arguments)}}(this),this},t.prototype._getAggregateRepository=function(t,n){var e,r,i;return r||(r={}),r[t]||(e=this._aggregateRootClasses[t],i=new this._eventric.Repository({aggregateName:t,AggregateRoot:e,context:this,eventric:this._eventric}),r[t]=i),r[t].setCommand(n),r[t]},t.prototype.addCommandHandlers=function(t){var n,e;for(e in t)n=t[e],this.addCommandHandler(e,n);return this},t.prototype.addQueryHandler=function(t,n){return this._queryHandlers[t]=function(t){return function(){return n.apply(t._di,arguments)}}(this),this},t.prototype.addQueryHandlers=function(t){var n,e;for(e in t)n=t[e],this.addQueryHandler(e,n);return this},t.prototype.addAggregate=function(t,n){return this._aggregateRootClasses[t]=n,this},t.prototype.addAggregates=function(t){var n,e;for(e in t)n=t[e],this.addAggregate(e,n);return this},t.prototype.subscribeToDomainEvent=function(t,n,e){var r;return null==e&&(e={}),r=function(t){return function(){return n.apply(t._di,arguments)}}(this),this._eventBus.subscribeToDomainEvent(t,r,e)},t.prototype.subscribeToDomainEvents=function(t){var n,e,r;r=[];for(n in t)e=t[n],r.push(this.subscribeToDomainEvent(n,e));return r},t.prototype.subscribeToDomainEventWithAggregateId=function(t,n,e,r){var i;return null==r&&(r={}),i=function(t){return function(){return e.apply(t._di,arguments)}}(this),this._eventBus.subscribeToDomainEventWithAggregateId(t,n,i,r)},t.prototype.subscribeToAllDomainEvents=function(t,n){var e;return null==n&&(n={}),e=function(n){return function(){return t.apply(n._di,arguments)}}(this),this._eventBus.subscribeToAllDomainEvents(e,n)},t.prototype.subscribeToDomainEventStream=function(t,n,e){var r,i,o,s,u,a,c;if(null==e&&(e={}),!this._domainEventStreamClasses[t])return u="DomainEventStream Class with name "+t+" not added",this.log.error(u);o=new this._domainEventStreamClasses[t],o._domainEventsPublished={},s=this._eventric.generateUid(),this._domainEventStreamInstances[s]=o,i=[];for(a in o)c=o[a],0===a.indexOf("filter")&&"function"==typeof c&&(r=a.replace(/^filter/,""),i.push(r));return this._applyDomainEventsFromStoreToDomainEventStream(i,o,n).then(function(t){return function(){var s,u,a;for(a=[],s=0,u=i.length;u>s;s++)r=i[s],a.push(t.subscribeToDomainEvent(r,function(t){return o._domainEventsPublished[t.id]?void 0:o["filter"+t.name](t)===!0?n(t,function(){}):void 0},e));return a}}(this)),s},t.prototype._applyDomainEventsFromStoreToDomainEventStream=function(t,n){return new Promise(function(e){return function(r,i){return e.findDomainEventsByName(t).then(function(o){return o&&0!==o.length?e._eventric.eachSeries(o,function(t,e){return n["filter"+t.name](t)===!0?(handlerFn(t,function(){}),n._domainEventsPublished[t.id]=!0,e()):void 0},function(n){return n?i(n):r(t)}):r(t)})["catch"](function(t){return i(t)})}}(this))},t.prototype.addDomainService=function(t,n){return this._domainServices[t]=function(t){return function(){return n.apply(t._di,arguments)}}(this),this},t.prototype.addDomainServices=function(t){var n,e;for(e in t)n=t[e],this.addDomainService(e,n);return this},t.prototype.addAdapter=function(t,n){return this._adapterClasses[t]=n,this},t.prototype.addAdapters=function(t){var n,e;for(n in t)e=t[n],this.addAdapter(n,e);return this},t.prototype.addProjection=function(t,n){return this._projectionClasses[t]=n,this},t.prototype.addProjections=function(t){var n,e;for(e in t)n=t[e],this.addProjection(e,n);return this},t.prototype.addDomainEventStream=function(t,n){return this._domainEventStreamClasses[t]=n,this},t.prototype.addDomainEventStreams=function(t){var n,e;for(e in t)n=t[e],this.addDomainEventStream(e,n);return this},t.prototype.getProjectionInstance=function(t){return this.projectionService.getInstance(t)},t.prototype.destroyProjectionInstance=function(t){return this.projectionService.destroyInstance(t,this)},t.prototype.initializeProjectionInstance=function(t,n){var e;return this._projectionClasses[t]?this.projectionService.initializeInstance(t,this._projectionClasses[t],n,this):(e="Given projection "+t+" not registered on context",this._eventric.log.error(e),e=new Error(e))},t.prototype.initialize=function(t){return null==t&&(t=function(){}),new Promise(function(n){return function(e,r){return n.log.debug("["+n.name+"] Initializing"),n.log.debug("["+n.name+"] Initializing Store"),n._initializeStores().then(function(){return n.log.debug("["+n.name+"] Finished initializing Store"),n._di={$adapter:function(){return n.getAdapter.apply(n,arguments)},$query:function(){return n.query.apply(n,arguments)},$domainService:function(){return n.getDomainService(arguments[0]).apply(n,[arguments[1],arguments[2]])},$projectionStore:function(){return n.getProjectionStore.apply(n,arguments)},$emitDomainEvent:function(){return n.emitDomainEvent.apply(n,arguments)}},n.log.debug("["+n.name+"] Initializing Adapters"),n._initializeAdapters()}).then(function(){return n.log.debug("["+n.name+"] Finished initializing Adapters"),n.log.debug("["+n.name+"] Initializing Projections"),n._initializeProjections()}).then(function(){return n.log.debug("["+n.name+"] Finished initializing Projections"),n.log.debug("["+n.name+"] Finished initializing"),n._initialized=!0,t(),e()})["catch"](function(n){return t(n),r(n)})}}(this))},t.prototype._initializeStores=function(){return new Promise(function(t){return function(n,e){var r,i,o,s;o=[],s=t._eventric.defaults(t._storeClasses,t._eventric.getStores());for(i in s)r=s[i],o.push({name:i,Class:r.Class,options:r.options});return t._eventric.eachSeries(o,function(n,e){return t.log.debug("["+t.name+"] Initializing Store "+n.name),t._storeInstances[n.name]=new n.Class,t._storeInstances[n.name].initialize(t,n.options,function(){return t.log.debug("["+t.name+"] Finished initializing Store "+n.name),e()})},function(t){return t?e(t):n()})}}(this))},t.prototype._initializeProjections=function(){return new Promise(function(t){return function(n,e){var r,i,o,s;o=[],s=t._projectionClasses;for(i in s)r=s[i],o.push({name:i,"class":r});return t._eventric.eachSeries(o,function(n,r){var i;return i=null,t.log.debug("["+t.name+"] Initializing Projection "+n.name),t.projectionService.initializeInstance(n.name,n["class"],{},t).then(function(){return t.log.debug("["+t.name+"] Finished initializing Projection "+n.name),r()})["catch"](function(t){return e(t)})},function(t){return t?e(t):n()})}}(this))},t.prototype._initializeAdapters=function(){return new Promise(function(t){return function(n){var e,r,i,o;o=t._adapterClasses;for(i in o)r=o[i],e=new t._adapterClasses[i],"function"==typeof e.initialize&&e.initialize(),t._adapterInstances[i]=e;return n()}}(this))},t.prototype.getProjection=function(t){return this.projectionService.getInstance(t)},t.prototype.getAdapter=function(t){return this._adapterInstances[t]},t.prototype.getDomainEvent=function(t){return this._domainEventClasses[t]},t.prototype.getDomainService=function(t){return this._domainServices[t]},t.prototype.getDomainEventsStore=function(){var t;return t=this.get("default domain events store"),this._storeInstances[t]},t.prototype.saveDomainEvent=function(t){return new Promise(function(n){return function(e,r){return n.getDomainEventsStore().saveDomainEvent(t,function(i,o){return n.publishDomainEvent(t),i?r(i):e(o)})}}(this))},t.prototype.findAllDomainEvents=function(){return new Promise(function(t){return function(n,e){return t.getDomainEventsStore().findAllDomainEvents(function(t,r){return t?e(t):n(r)})}}(this))},t.prototype.findDomainEventsByName=function(){var t;return t=1<=arguments.length?o.call(arguments,0):[],new Promise(function(n){return function(e,r){var i;return(i=n.getDomainEventsStore()).findDomainEventsByName.apply(i,o.call(t).concat([function(t,n){return t?r(t):e(n)}]))}}(this))},t.prototype.findDomainEventsByAggregateId=function(){var t;return t=1<=arguments.length?o.call(arguments,0):[],new Promise(function(n){return function(e,r){var i;return(i=n.getDomainEventsStore()).findDomainEventsByAggregateId.apply(i,o.call(t).concat([function(t,n){return t?r(t):e(n)}]))}}(this))},t.prototype.findDomainEventsByNameAndAggregateId=function(){var t;return t=1<=arguments.length?o.call(arguments,0):[],new Promise(function(n){return function(e,r){var i;return(i=n.getDomainEventsStore()).findDomainEventsByNameAndAggregateId.apply(i,o.call(t).concat([function(t,n){return t?r(t):e(n)}]))}}(this))},t.prototype.findDomainEventsByAggregateName=function(){var t;return t=1<=arguments.length?o.call(arguments,0):[],new Promise(function(n){return function(e,r){var i;return(i=n.getDomainEventsStore()).findDomainEventsByAggregateName.apply(i,o.call(t).concat([function(t,n){return t?r(t):e(n)}]))}}(this))},t.prototype.getProjectionStore=function(t,n,e){return new Promise(function(r){return function(i,o){var s;return r._storeInstances[t]?r._storeInstances[t].getProjectionStore(n,function(t,n){return"function"==typeof e&&e(t,n),t?o(t):i(n)}):(s="Requested Store with name "+t+" not found",r.log.error(s),"function"==typeof e&&e(s,null),o(s))}}(this))},t.prototype.clearProjectionStore=function(t,n,e){return new Promise(function(r){return function(i,o){var s;return r._storeInstances[t]?r._storeInstances[t].clearProjectionStore(n,function(t,n){return"function"==typeof e&&e(t,n),t?o(t):i(n)}):(s="Requested Store with name "+t+" not found",r.log.error(s),"function"==typeof e&&e(s,null),o(s))}}(this))},t.prototype.getEventBus=function(){return this._eventBus},t.prototype.command=function(t,n){return this.log.debug("Got Command",t),new Promise(function(e){return function(r,i){var o;return e._initialized?e._commandHandlers[t]?e._commandHandlers[t](n,function(n,o){return e.log.debug("Completed Command",t),e._eventric.nextTick(function(){return n?i(n):r(o)})}):(o="Given command "+t+" not registered on context",e.log.error(o),o=new Error(o),i(o)):(o="Context not initialized yet",e.log.error(o),o=new Error(o),i(o))}}(this))},t.prototype.query=function(t,n){return this.log.debug("Got Query",t),new Promise(function(e){return function(r,i){var o;return e._initialized?e._queryHandlers[t]?e._queryHandlers[t](n,function(n,o){return e.log.debug("Completed Query",t),e._eventric.nextTick(function(){return n?i(n):r(o)})}):(o="Given query "+t+" not registered on context",e.log.error(o),o=new Error(o),i(o)):(o="Context not initialized yet",e.log.error(o),o=new Error(o),void i(o))}}(this))},t.prototype.enableWaitingMode=function(){return this.set("waiting mode",!0)},t.prototype.disableWaitingMode=function(){return this.set("waiting mode",!1)},t.prototype.isWaitingModeEnabled=function(){return this.get("waiting mode")},t}(),e.exports=r}),require.register("eventric/context/index",function(t,n,e){e.exports=n("./context")}),require.register("eventric/domain_event/domain_event",function(t,n,e){var r;r=function(){function t(t){this.id=t.id,this.name=t.name,this.payload=t.payload,this.aggregate=t.aggregate,this.context=t.context,this.timestamp=(new Date).getTime()}return t}(),e.exports=r}),require.register("eventric/domain_event/index",function(t,n,e){e.exports=n("./domain_event")}),require.register("eventric/event_bus/event_bus",function(t,n,e){var r;r=function(){function t(t){this._eventric=t,this._pubSub=new this._eventric.PubSub}return t.prototype.subscribeToDomainEvent=function(t,n,e){return null==e&&(e={}),e.isAsync?this._pubSub.subscribeAsync(t,n):this._pubSub.subscribe(t,n)},t.prototype.subscribeToDomainEventWithAggregateId=function(t,n,e,r){return null==r&&(r={}),this.subscribeToDomainEvent(""+t+"/"+n,e,r)},t.prototype.subscribeToAllDomainEvents=function(t){return this._pubSub.subscribe("DomainEvent",t)},t.prototype.publishDomainEvent=function(t){return this._publish("publish",t)},t.prototype.publishDomainEventAndWait=function(t){return this._publish("publishAsync",t)},t.prototype._publish=function(t,n){return new Promise(function(e){return function(r){return e._pubSub[t]("DomainEvent",n).then(function(){return e._pubSub[t](n.name,n)}).then(function(){return n.aggregate&&n.aggregate.id?e._pubSub[t](""+n.name+"/"+n.aggregate.id,n).then(function(){return r()}):r()})}}(this))},t}(),e.exports=r}),require.register("eventric/event_bus/index",function(t,n,e){e.exports=n("./event_bus")}),require.register("eventric/process_manager/index",function(t,n,e){e.exports=n("./process_manager")}),require.register("eventric/process_manager/process_manager",function(t,n,e){var r;r=function(){function t(){this._processManagerInstances={}}return t.prototype.add=function(t,n,e){var r,i,o,s,u;s=n.initializeWhen,u=[];for(r in s)o=s[r],u.push(function(){var s,u,a;for(a=[],s=0,u=o.length;u>s;s++)i=o[s],a.push(e.subscribeToDomainEvent(r,i,function(i){return function(o){return i._spawnProcessManager(t,n["class"],r,o,e)}}(this)));return a}.call(this));return u},t.prototype._spawnProcessManager=function(t,n,e,r,i){var o,s,u,a,c,l,p;a=i.generateUid(),u=new n,u.$endProcess=function(n){return function(){return n._endProcessManager(t,a)}}(this),o=[];for(s in u)c=u[s],0===s.indexOf("from")&&"function"==typeof c&&o.push(s);return this._subscribeProcessManagerToDomainEvents(u,o,i),u.initialize(r),null==(l=this._processManagerInstances)[t]&&(l[t]={}),null==(p=this._processManagerInstances[t])[a]&&(p[a]={}),this._processManagerInstances[t][a]=u},t.prototype._endProcessManager=function(t,n){return delete this._processManagerInstances[t][n]},t.prototype._subscribeProcessManagerToDomainEvents=function(t,n,e){return e.subscribeToDomainEvent(function(e){return function(r){var i,o,s,u;for(u=[],o=0,s=n.length;s>o;o++)i=n[o],u.push("from"+r.context+"_handle"+r.name===i?e._applyDomainEventToProcessManager(i,r,t):void 0);return u}}(this))},t.prototype._applyDomainEventToProcessManager=function(t,n,e){var r;return e[t]?e[t](n):r=new Error("Tried to apply DomainEvent '"+domainEventName+"' to Projection without a matching handle method")},t}(),e.exports=new r}),require.register("eventric/projection/index",function(t,n,e){e.exports=n("./projection")}),require.register("eventric/projection/projection",function(t,n,e){var r,i=function(t,n){return function(){return t.apply(n,arguments)}};r=function(){function t(t){this._eventric=t,this._applyDomainEventToProjection=i(this._applyDomainEventToProjection,this),this.log=this._eventric.log,this._handlerFunctions={},this._projectionInstances={},this._domainEventsApplied={}}return t.prototype.initializeInstance=function(t,n,e,r){return this._context=r,new Promise(function(r){return function(i,o){var s,u,a,c,l,p,f;if(l="function"==typeof n?new n:n,r._context._di){f=r._context._di;for(a in f)u=f[a],l[a]=u}return p=r._eventric.generateUid(),s=null,l.$subscribeHandlersWithAggregateId=function(t){return s=t},c=null,l.$subscribeToDomainEventStream=function(t){return c=t},r.log.debug("["+r._context.name+"] Clearing ProjectionStores of "+t),r._clearProjectionStores(l.stores,t).then(function(){return r.log.debug("["+r._context.name+"] Finished clearing ProjectionStores of "+t),r._injectStoresIntoProjection(t,l)}).then(function(){return r._callInitializeOnProjection(t,l,e)}).then(function(){return r.log.debug("["+r._context.name+"] Replaying DomainEvents against Projection "+t),r._parseEventNamesFromProjection(l)}).then(function(t){return r._applyDomainEventsFromStoreToProjection(p,l,t,s)}).then(function(n){return r.log.debug("["+r._context.name+"] Finished Replaying DomainEvents against Projection "+t),r._subscribeProjectionToDomainEvents(p,t,l,n,s,c)}).then(function(){var n;return r._projectionInstances[p]=l,n={id:p,projection:l},r._context.publish("projection:"+t+":initialized",n),r._context.publish("projection:"+p+":initialized",n),i(p)})["catch"](function(t){return o(t)})}}(this))},t.prototype._callInitializeOnProjection=function(t,n,e){return new Promise(function(r){return function(i){return n.initialize?(r.log.debug("["+r._context.name+"] Calling initialize on Projection "+t),n.initialize(e,function(){return r.log.debug("["+r._context.name+"] Finished initialize call on Projection "+t),i(n)
})):(r.log.debug("["+r._context.name+"] No initialize function on Projection "+t+" given, skipping"),i(n))}}(this))},t.prototype._injectStoresIntoProjection=function(t,n){return new Promise(function(e){return function(r,i){return n.stores?(null==n.$store&&(n.$store={}),e._eventric.eachSeries(n.stores,function(r,i){return e.log.debug("["+e._context.name+"] Injecting ProjectionStore "+r+" into Projection "+t),e._context.getProjectionStore(r,t,function(o,s){return s?(n.$store[r]=s,e.log.debug("["+e._context.name+"] Finished Injecting ProjectionStore "+r+" into Projection "+t),i()):void 0})},function(t){return t?i(t):r()})):r()}}(this))},t.prototype._clearProjectionStores=function(t,n){return new Promise(function(e){return function(r){return t?e._eventric.eachSeries(t,function(t,r){return e.log.debug("["+e._context.name+"] Clearing ProjectionStore "+t+" for "+n),e._context.clearProjectionStore(t,n,function(){return e.log.debug("["+e._context.name+"] Finished clearing ProjectionStore "+t+" for "+n),r()})},function(){return r()}):r()}}(this))},t.prototype._parseEventNamesFromProjection=function(t){return new Promise(function(){return function(n){var e,r,i,o;r=[];for(i in t)o=t[i],0===i.indexOf("handle")&&"function"==typeof o&&(e=i.replace(/^handle/,""),r.push(e));return n(r)}}(this))},t.prototype._applyDomainEventsFromStoreToProjection=function(t,n,e,r){return new Promise(function(i){return function(o,s){var u;return i._domainEventsApplied[t]={},u=r?i._context.findDomainEventsByNameAndAggregateId(e,r):i._context.findDomainEventsByName(e),u.then(function(r){return r&&0!==r.length?i._eventric.eachSeries(r,function(e,r){return i._applyDomainEventToProjection(e,n,function(){return i._domainEventsApplied[t][e.id]=!0,r()})},function(t){return t?s(t):o(e)}):o(e)}),u["catch"](function(t){return s(t)})}}(this))},t.prototype._subscribeProjectionToDomainEvents=function(t,n,e,r,i,o){return new Promise(function(s){return function(u){var a,c,l,p,f,m,h;if(a=function(r,i){return null==i&&(i=function(){}),s._domainEventsApplied[t][r.id]?i():s._applyDomainEventToProjection(r,e,function(){var o;return s._domainEventsApplied[t][r.id]=!0,o={id:t,projection:e,domainEvent:r},s._context.publish("projection:"+n+":changed",o),s._context.publish("projection:"+t+":changed",o),i()})},o)l=s._context.subscribeToDomainEventStream(o,a,{isAsync:!0}),null==(p=s._handlerFunctions)[t]&&(p[t]=[]),s._handlerFunctions[t].push(l);else for(m=0,h=r.length;h>m;m++)c=r[m],l=i?s._context.subscribeToDomainEventWithAggregateId(c,i,a,{isAsync:!0}):s._context.subscribeToDomainEvent(c,a,{isAsync:!0}),null==(f=s._handlerFunctions)[t]&&(f[t]=[]),s._handlerFunctions[t].push(l);return u()}}(this))},t.prototype._applyDomainEventToProjection=function(t,n,e){return n["handle"+t.name]?2===n["handle"+t.name].length?n["handle"+t.name](t,e):(n["handle"+t.name](t),e()):(this.log.debug("Tried to apply DomainEvent '"+t.name+"' to Projection without a matching handle method"),e())},t.prototype.getInstance=function(t){return this._projectionInstances[t]},t.prototype.destroyInstance=function(t){var n,e,r,i;if(!this._handlerFunctions[t])return this._eventric.log.error("Missing attribute projectionId");for(i=this._handlerFunctions[t],e=0,r=i.length;r>e;e++)n=i[e],this._context.unsubscribeFromDomainEvent(n);return delete this._handlerFunctions[t],delete this._projectionInstances[t]},t}(),e.exports=r}),require.register("eventric/pub_sub/index",function(t,n,e){e.exports=n("./pub_sub")}),require.register("eventric/pub_sub/pub_sub",function(t,n,e){var r,i=[].slice;r=function(){function t(){this._subscribers=[],this._subscriberId=0,this._nextTick=function(){var t;return t=1<=arguments.length?i.call(arguments,0):[],setTimeout.apply(null,t)}}return t.prototype.subscribe=function(t,n){return new Promise(function(e){return function(r){var i;return i={eventName:t,subscriberFn:n,subscriberId:e._getNextSubscriberId()},e._subscribers.push(i),r(i.subscriberId)}}(this))},t.prototype.subscribeAsync=function(t,n){return new Promise(function(e){return function(r){var i;return i={eventName:t,subscriberFn:n,subscriberId:e._getNextSubscriberId(),isAsync:!0},e._subscribers.push(i),r(i.subscriberId)}}(this))},t.prototype.publish=function(t,n){return new Promise(function(e){return function(r){var i,o;return o=e._getRelevantSubscribers(t),i=function(){return 0===o.length?r():(o.shift().subscriberFn(n,function(){}),e._nextTick(i,0))},e._nextTick(i,0)}}(this))},t.prototype.publishAsync=function(t,n){return new Promise(function(e){return function(r){var i,o;return o=e._getRelevantSubscribers(t),i=function(){var t;return 0===o.length?r():(t=o.shift(),t.isAsync?t.subscriberFn(n,function(){return setTimeout(i,0)}):(t.subscriberFn(n),e._nextTick(i,0)))},e._nextTick(i,0)}}(this))},t.prototype._getRelevantSubscribers=function(t){return t?this._subscribers.filter(function(n){return n.eventName===t}):this._subscribers},t.prototype.unsubscribe=function(t){return new Promise(function(n){return function(e){return n._subscribers=n._subscribers.filter(function(n){return n.subscriberId!==t}),e()}}(this))},t.prototype._getNextSubscriberId=function(){return this._subscriberId++},t}(),e.exports=r}),require.register("eventric/remote/index",function(t,n,e){e.exports=n("./remote")}),require.register("eventric/remote/remote",function(t,n,e){var r;r=function(){function t(t,e){this._contextName=t,this._eventric=e,this.name=this._contextName,this.InMemoryRemote=n("./inmemory"),this._params={},this._clients={},this._projectionClasses={},this._projectionInstances={},this._handlerFunctions={},this.addClient("inmemory",this.InMemoryRemote.client),this.set("default client","inmemory")}return t.prototype.set=function(t,n){return this._params[t]=n,this},t.prototype.get=function(t){return this._params[t]},t.prototype.command=function(){return this._rpc("command",arguments)},t.prototype.query=function(){return this._rpc("query",arguments)},t.prototype.findAllDomainEvents=function(){return this._rpc("findAllDomainEvents",arguments)},t.prototype.findDomainEventsByName=function(){return this._rpc("findDomainEventsByName",arguments)},t.prototype.findDomainEventsByAggregateId=function(){return this._rpc("findDomainEventsByAggregateId",arguments)},t.prototype.findDomainEventsByAggregateName=function(){return this._rpc("findDomainEventsByAggregateName",arguments)},t.prototype.findDomainEventsByNameAndAggregateId=function(){return this._rpc("findDomainEventsByNameAndAggregateId",arguments)},t.prototype.subscribeToAllDomainEvents=function(t,n){var e,r;return null==n&&(n={}),r=this.get("default client"),e=this.getClient(r),e.subscribe(this._contextName,t)},t.prototype.subscribeToDomainEvent=function(t,n,e){var r,i;return null==e&&(e={}),i=this.get("default client"),r=this.getClient(i),r.subscribe(this._contextName,t,n)},t.prototype.subscribeToDomainEventWithAggregateId=function(t,n,e,r){var i,o;return null==r&&(r={}),o=this.get("default client"),i=this.getClient(o),i.subscribe(this._contextName,t,n,e)},t.prototype.subscribeToDomainEventStream=function(){return this._rpc("subscribeToDomainEventStream",arguments)},t.prototype.unsubscribeFromDomainEvent=function(t){var n,e;return e=this.get("default client"),n=this.getClient(e),n.unsubscribe(t)},t.prototype._rpc=function(t,n){return new Promise(function(e){return function(r,i){var o,s;return s=e.get("default client"),o=e.getClient(s),o.rpc({contextName:e._contextName,method:t,params:Array.prototype.slice.call(n)},function(t,n){return t?i(t):r(n)})}}(this))},t.prototype.addClient=function(t,n){return this._clients[t]=n,this},t.prototype.getClient=function(t){return this._clients[t]},t.prototype.addProjection=function(t,n){return this._projectionClasses[t]=n,this},t.prototype.initializeProjection=function(t,n){return this._eventric.projectionService.initializeInstance("",t,n,this)},t.prototype.initializeProjectionInstance=function(t,n){var e;return this._projectionClasses[t]?this._eventric.projectionService.initializeInstance(t,this._projectionClasses[t],n,this):(e="Given projection "+t+" not registered on remote",this._eventric.log.error(e),e=new Error(e))},t.prototype.getProjectionInstance=function(t){return this._eventric.projectionService.getInstance(t)},t.prototype.destroyProjectionInstance=function(t){return this._eventric.projectionService.destroyInstance(t,this)},t}(),e.exports=r}),require.register("eventric/repository/index",function(t,n,e){e.exports=n("./repository")}),require.register("eventric/repository/repository",function(t,n,e){var r,i=function(t,n){return function(){return t.apply(n,arguments)}};r=function(){function t(t,n){this._eventric=n,this.save=i(this.save,this),this.create=i(this.create,this),this.findById=i(this.findById,this),this._aggregateName=t.aggregateName,this._AggregateRoot=t.AggregateRoot,this._context=t.context,this._eventric=t.eventric,this._command={},this._aggregateInstances={},this._store=this._context.getDomainEventsStore()}return t.prototype.findById=function(t,n){return null==n&&(n=function(){}),new Promise(function(e){return function(r,i){return e._findDomainEventsForAggregate(t,function(o,s){var u,a,c,l;return o?(n(o,null),void i(o)):s.length?(u=new e._eventric.Aggregate(e._context,e._eventric,e._aggregateName,e._AggregateRoot),u.applyDomainEvents(s),u.id=t,u.root.$id=t,u.root.$save=function(){return e.save(u.id)},a=null!=(l=e._command.id)?l:"nocommand",null==(c=e._aggregateInstances)[a]&&(c[a]={}),e._aggregateInstances[a][t]=u,n(null,u.root),r(u.root)):(o="No domainEvents for "+e._aggregateName+" Aggregate with "+t+" available",eventric.log.error(o),n(o,null),void i(o))})}}(this))},t.prototype._findDomainEventsForAggregate=function(t,n){return this._store.findDomainEventsByAggregateId(t,function(){return function(t,e){return t?n(t,null):0===e.length?n(null,[]):n(null,e)}}(this))},t.prototype.create=function(){var t,n;return n=arguments,"function"==typeof n[n.length-1]&&(t=n.pop()),new Promise(function(e){return function(r){var i;return i=new e._eventric.Aggregate(e._context,e._eventric,e._aggregateName,e._AggregateRoot),i.create.apply(i,n).then(function(n){var i,o,s;return n.root.$id=n.id,n.root.$save=function(){return e.save(n.id)},i=null!=(s=e._command.id)?s:"nocommand",null==(o=e._aggregateInstances)[i]&&(o[i]={}),e._aggregateInstances[i][n.id]=n,"function"==typeof t&&t(null,n.root),r(n.root)})}}(this))},t.prototype.save=function(t,n){return null==n&&(n=function(){}),new Promise(function(e){return function(r,i){var o,s,u,a,c;return s=null!=(c=e._command.id)?c:"nocommand",(o=e._aggregateInstances[s][t])?(u=o.getDomainEvents(),u.length<1?(a="Tried to save 0 DomainEvents from Aggregate "+e._aggregateName,eventric.log.debug(a,e._command),a=new Error(a),"function"==typeof n&&n(a,null),void i(a)):(eventric.log.debug("Going to Save and Publish "+u.length+" DomainEvents from Aggregate "+e._aggregateName),eventric.eachSeries(u,function(t,n){return t.command=e._command,e._store.saveDomainEvent(t,function(){return eventric.log.debug("Saved DomainEvent",t),n(null)})},function(t){var s,a,c;if(t)return n(t,null),i(t);if(e._context.isWaitingModeEnabled())return eventric.eachSeries(u,function(t,n){return eventric.log.debug("Publishing DomainEvent in waiting mode",t),e._context.getEventBus().publishDomainEventAndWait(t).then(function(){return n()})},function(t){return t?(n(t,null),i(t)):(r(o.id),n(null,o.id))});for(a=0,c=u.length;c>a;a++)s=u[a],eventric.log.debug("Publishing DomainEvent",s),e._context.getEventBus().publishDomainEvent(s);return r(o.id),n(null,o.id)}))):(a="Tried to save unknown aggregate "+e._aggregateName,eventric.log.error(a),a=new Error(a),"function"==typeof n&&n(a,null),void i(a))}}(this))},t.prototype.setCommand=function(t){return this._command=t},t}(),e.exports=r}),require.register("eventric/remote/inmemory/index",function(t,n,e){e.exports=n("./remote_inmemory")}),require.register("eventric/remote/inmemory/remote_inmemory",function(t,n,e){var r,i,o,s,u,a,c=[].slice;o=n("../../pub_sub"),s=null,a=new o,i=function(){function t(){s=function(t){return function(n){return new Promise(function(e,r){return t._handleRPCRequest(n,function(t,n){return t?r(t):e(n)})})}}(this)}return t.prototype.setRPCHandler=function(t){this._handleRPCRequest=t},t.prototype.publish=function(){var t,n,e,r,i,o,s;return n=arguments[0],o=3<=arguments.length?c.call(arguments,1,s=arguments.length-1):(s=1,[]),i=arguments[s++],e=o[0],t=o[1],r=u(n,e,t),a.publish(r,i,function(){})},t}(),e.exports.endpoint=new i,r=function(){function t(){}return t.prototype.rpc=function(t,n){if(!s)throw new Error("No Remote Endpoint available for in memory client");return s(t).then(function(t){return n(null,t)})["catch"](function(t){return n(t)})},t.prototype.subscribe=function(){var t,n,e,r,i,o,s;return n=arguments[0],o=3<=arguments.length?c.call(arguments,1,s=arguments.length-1):(s=1,[]),i=arguments[s++],e=o[0],t=o[1],r=u(n,e,t),a.subscribe(r,i)},t.prototype.unsubscribe=function(t){return a.unsubscribe(t)},t}(),e.exports.client=new r,u=function(t,n,e){var r;return r=t,n&&(r+="/"+n),e&&(r+="/"+e),r}}),require.register("eventric/store/inmemory/index",function(t,n,e){e.exports=n("./store_inmemory")}),require.register("eventric/store/inmemory/store_inmemory",function(t,n,e){var r,i,o=[].slice;i=["domain_events","projections"],r=function(){function t(){}return t.prototype._domainEvents={},t.prototype._projections={},t.prototype.initialize=function(){var t,n,e,r,i;return r=arguments[0],e=3<=arguments.length?o.call(arguments,1,i=arguments.length-1):(i=1,[]),t=arguments[i++],this._context=r,n=e[0],this._domainEventsCollectionName=""+this._context.name+".DomainEvents",this._projectionCollectionName=""+this._context.name+".Projections",this._domainEvents[this._domainEventsCollectionName]=[],t()},t.prototype.saveDomainEvent=function(t,n){return this._domainEvents[this._domainEventsCollectionName].push(t),n(null,t)},t.prototype.findAllDomainEvents=function(t){return t(null,this._domainEvents[this._domainEventsCollectionName])},t.prototype.findDomainEventsByName=function(t,n){var e,r;return e=t instanceof Array?function(n){return t.indexOf(n)>-1}:function(n){return n===t},r=this._domainEvents[this._domainEventsCollectionName].filter(function(t){return e(t.name)}),n(null,r)},t.prototype.findDomainEventsByNameAndAggregateId=function(t,n,e){var r,i,o;return i=t instanceof Array?function(n){return t.indexOf(n)>-1}:function(n){return n===t},r=n instanceof Array?function(t){return n.indexOf(t)>-1}:function(t){return t===n},o=this._domainEvents[this._domainEventsCollectionName].filter(function(t){var n;return i(t.name)&&r(null!=(n=t.aggregate)?n.id:void 0)}),e(null,o)},t.prototype.findDomainEventsByAggregateId=function(t,n){var e,r;return e=t instanceof Array?function(n){return t.indexOf(n)>-1}:function(n){return n===t},r=this._domainEvents[this._domainEventsCollectionName].filter(function(t){var n;return e(null!=(n=t.aggregate)?n.id:void 0)}),n(null,r)},t.prototype.findDomainEventsByAggregateName=function(t,n){var e,r;return e=t instanceof Array?function(n){return t.indexOf(n)>-1}:function(n){return n===t},r=this._domainEvents[this._domainEventsCollectionName].filter(function(t){var n;return e(null!=(n=t.aggregate)?n.name:void 0)}),n(null,r)},t.prototype.getProjectionStore=function(t,n){var e,r,i;return null==(e=this._projections)[i=this._projectionCollectionName]&&(e[i]={}),null==(r=this._projections[this._projectionCollectionName])[t]&&(r[t]={}),n(null,this._projections[this._projectionCollectionName][t])},t.prototype.clearProjectionStore=function(t,n){var e,r,i;return null==(e=this._projections)[i=this._projectionCollectionName]&&(e[i]={}),null==(r=this._projections[this._projectionCollectionName])[t]&&(r[t]={}),delete this._projections[this._projectionCollectionName][t],n(null,null)},t.prototype.checkSupport=function(t){return i.indexOf(t)>-1},t}(),e.exports=r});