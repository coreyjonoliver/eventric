!function(){"use strict";var t="undefined"==typeof window?global:window;if("function"!=typeof t.require){var n={},e={_load:function(t,r){var i=e._resolveFilename(t,r),s=n[i];if(!s)throw new Error('Cannot find module "'+i+'" from "'+r+'"');if(e._cache[i])return e._cache[i].exports;var u=o(i),a={id:i,exports:{}};return e._cache[i]=a,s.call(a.exports,a.exports,u,a),a.exports},_cache:{},_resolveFilename:function(t,e){var r=i(s(e),t);return n.hasOwnProperty(r)?r:(r=i(r,"./index"),n.hasOwnProperty(r)?r:t)}},r=function(t,n){return e._load(t,n)},i=function(){var t=/^\.\.?(\/|$)/;return function(n,e){var r,i,o=[];r=(t.test(e)?n+"/"+e:e).split("/");for(var s=0,u=r.length;u>s;s++)i=r[s],".."===i?o.pop():"."!==i&&""!==i&&o.push(i);return o.join("/")}}(),o=function(n){return function(e){return t.require(e,n)}},s=function(t){return t?t.split("/").slice(0,-1).join("/"):""};r.register=r.define=function(t,e){if("object"==typeof t)for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);else n[t]=e},r.list=function(){var t=[];for(var e in n)n.hasOwnProperty(e)&&t.push(e);return t},t.require=r,r.define("module",function(t,n,r){r.exports=e})}}(),require.register("eventric/eventric",function(t,n,e){var r,i=function(t,n){return function(){return t.apply(n,arguments)}},o=[].slice;r=function(){function t(){this._handleRemoteRPCRequest=i(this._handleRemoteRPCRequest,this),this.PubSub=n("./pub_sub"),this.EventBus=n("./event_bus"),this.Remote=n("./remote"),this.Context=n("./context"),this.DomainEvent=n("./domain_event"),this.Aggregate=n("./aggregate"),this.Repository=n("./repository"),this.Projection=n("./projection"),this.ProcessManager=n("./process_manager"),this.Logger=n("./logger"),this.RemoteInMemory=n("./remote/inmemory"),this.StoreInMemory=n("./store/inmemory"),this.log=this.Logger,this._contexts={},this._params={},this._processManagerInstances={},this._processManagerService=this.ProcessManager,this._domainEventHandlers={},this._domainEventHandlersAll=[],this._storeClasses={},this._remoteEndpoints=[],this.addRemoteEndpoint("inmemory",this.RemoteInMemory.endpoint),this.addStore("inmemory",this.StoreInMemory),this.set("default domain events store","inmemory")}return t.prototype.set=function(t,n){return this._params[t]=n},t.prototype.get=function(t){return t?this._params[t]:this._params},t.prototype.addStore=function(t,n,e){return null==e&&(e={}),this._storeClasses[t]={Class:n,options:e}},t.prototype.getStores=function(){return this._storeClasses},t.prototype.context=function(t){var n,e,r;if(!t)throw e="Contexts must have a name",this.log.error(e),new Error(e);return r=new this.PubSub,n=new this.Context(t,this),this.mixin(n,r),this._delegateAllDomainEventsToGlobalHandlers(n),this._delegateAllDomainEventsToRemoteEndpoints(n),this._contexts[t]=n,n},t.prototype.getContext=function(t){return this._contexts[t]},t.prototype.remote=function(t){var n,e,r;if(!t)throw n="Missing context name",this.log.error(n),new Error(n);return e=new this.PubSub,r=new this.Remote(t,this),this.mixin(r,e),r},t.prototype.addRemoteEndpoint=function(t,n){return this._remoteEndpoints.push(n),n.setRPCHandler(this._handleRemoteRPCRequest)},t.prototype._handleRemoteRPCRequest=function(t,n){var e,r;return e=this.getContext(t.contextName),e?t.method in e?e[t.method].apply(e,t.params).then(function(t){return n(null,t)})["catch"](function(t){return n(t)}):(r="Remote RPC method "+t.method+" not found on Context "+t.contextName,this.log.error(r),n(r,null)):(r="Tried to handle Remote RPC with not registered context "+t.contextName,this.log.error(r),n(r,null))},t.prototype._delegateAllDomainEventsToGlobalHandlers=function(t){return t.subscribeToAllDomainEvents(function(n){return function(e){var r,i,o,s,u;for(i=n.getDomainEventHandlers(t.name,e.name),u=[],o=0,s=i.length;s>o;o++)r=i[o],u.push(r(e));return u}}(this))},t.prototype._delegateAllDomainEventsToRemoteEndpoints=function(t){return t.subscribeToAllDomainEvents(function(n){return function(e){return n._remoteEndpoints.forEach(function(n){return n.publish(t.name,e.name,e),e.aggregate?n.publish(t.name,e.name,e.aggregate.id,e):void 0})}}(this))},t.prototype.subscribeToDomainEvent=function(){var t,n,e,r,i,s,u;return r=2<=arguments.length?o.call(arguments,0,u=arguments.length-1):(u=0,[]),n=arguments[u++],t=r[0],e=r[1],null==t&&(t="all"),null==e&&(e="all"),"all"===t&&"all"===e?this._domainEventHandlersAll.push(n):(null==(i=this._domainEventHandlers)[t]&&(i[t]={}),null==(s=this._domainEventHandlers[t])[e]&&(s[e]=[]),this._domainEventHandlers[t][e].push(n))},t.prototype.getDomainEventHandlers=function(t,n){var e,r,i,o,s;return[].concat(null!=(e=null!=(r=this._domainEventHandlers[t])?r[n]:void 0)?e:[],null!=(i=null!=(o=this._domainEventHandlers[t])?o.all:void 0)?i:[],null!=(s=this._domainEventHandlersAll)?s:[])},t.prototype.generateUid=function(t){var n,e;return n=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},e=t||"-",n()+n()+e+n()+e+n()+e+n()+e+n()+n()+n()},t.prototype.addProcessManager=function(t,n){return this._processManagerService.add(t,n,this)},t.prototype.nextTick=function(t){var n,e;return(n=null!=(e="undefined"!=typeof process&&null!==process?process.nextTick:void 0)?e:setTimeout)(function(){return t()})},t.prototype.defaults=function(t,n){var e,r,i,o;for(e=[].concat(Object.keys(t),Object.keys(n)),i=0,o=e.length;o>i;i++)r=e[i],!t[r]&&n[r]&&(t[r]=n[r]);return t},t.prototype.eachSeries=function(t,n,e){var r,i;return e=e||function(){},Array.isArray(t)&&t.length?(r=0,(i=function(){n(t[r],function(n){n?e(n):(++r,r>=t.length?e():i())})})()):e()},t.prototype.mixin=function(t,n){var e,r;r=[];for(e in n)r.push(t[e]=n[e]);return r},t}(),e.exports=r}),require.register("es6-promise",function(t,n,e){(function(){"use strict";function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function n(t){return"function"==typeof t}function r(t){return"object"==typeof t&&null!==t}function i(){}function o(){return function(){process.nextTick(c)}}function s(){var t=0,n=new M(c),e=document.createTextNode("");return n.observe(e,{characterData:!0}),function(){e.data=t=++t%2}}function u(){var t=new MessageChannel;return t.port1.onmessage=c,function(){t.port2.postMessage(0)}}function a(){return function(){setTimeout(c,1)}}function c(){for(var t=0;z>t;t+=2){var n=O[t],e=O[t+1];n(e),O[t]=void 0,O[t+1]=void 0}z=0}function l(){}function p(){return new TypeError("You cannot resolve a promise with itself")}function f(){return new TypeError("A promises callback cannot return that same promise.")}function h(t){try{return t.then}catch(n){return L.error=n,L}}function m(t,n,e,r){try{t.call(n,e,r)}catch(i){return i}}function g(t,n,e){B(function(t){var r=!1,i=m(e,n,function(e){r||(r=!0,n!==e?_(t,e):b(t,e))},function(n){r||(r=!0,E(t,n))},"Settle: "+(t._label||" unknown promise"));!r&&i&&(r=!0,E(t,i))},t)}function d(t,n){n._state===$?b(t,n._result):t._state===W?E(t,n._result):D(n,void 0,function(n){_(t,n)},function(n){E(t,n)})}function v(t,e){if(e.constructor===t.constructor)d(t,e);else{var r=h(e);r===L?E(t,L.error):void 0===r?b(t,e):n(r)?g(t,e,r):b(t,e)}}function _(n,e){n===e?E(n,p()):t(e)?v(n,e):b(n,e)}function y(t){t._onerror&&t._onerror(t._result),w(t)}function b(t,n){t._state===k&&(t._result=n,t._state=$,0===t._subscribers.length||B(w,t))}function E(t,n){t._state===k&&(t._state=W,t._result=n,B(y,t))}function D(t,n,e,r){var i=t._subscribers,o=i.length;t._onerror=null,i[o]=n,i[o+$]=e,i[o+W]=r,0===o&&t._state&&B(w,t)}function w(t){var n=t._subscribers,e=t._state;if(0!==n.length){for(var r,i,o=t._result,s=0;s<n.length;s+=3)r=n[s],i=n[s+e],r?j(e,r,i,o):i(o);t._subscribers.length=0}}function P(){this.error=null}function x(t,n){try{return t(n)}catch(e){return G.error=e,G}}function j(t,e,r,i){var o,s,u,a,c=n(r);if(c){if(o=x(r,i),o===G?(a=!0,s=o.error,o=null):u=!0,e===o)return void E(e,f())}else o=i,u=!0;e._state!==k||(c&&u?_(e,o):a?E(e,s):t===$?b(e,o):t===W&&E(e,o))}function S(t,n){try{n(function(n){_(t,n)},function(n){E(t,n)})}catch(e){E(t,e)}}function A(t,n,e,r){this._instanceConstructor=t,this.promise=new t(l,r),this._abortOnReject=e,this._validateInput(n)?(this._input=n,this.length=n.length,this._remaining=n.length,this._init(),0===this.length?b(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&b(this.promise,this._result))):E(this.promise,this._validationError())}function I(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function C(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function T(t){this._id=V++,this._state=void 0,this._result=void 0,this._subscribers=[],l!==t&&(n(t)||I(),this instanceof T||C(),S(this,t))}var N;N=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var R,q=N,z=(Date.now||function(){return(new Date).getTime()},Object.create||function(t){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof t)throw new TypeError("Argument must be an object");return i.prototype=t,new i},0),B=function(t,n){O[z]=t,O[z+1]=n,z+=2,2===z&&R()},F="undefined"!=typeof window?window:{},M=F.MutationObserver||F.WebKitMutationObserver,H="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,O=new Array(1e3);R="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?o():M?s():H?u():a();var k=void 0,$=1,W=2,L=new P,G=new P;A.prototype._validateInput=function(t){return q(t)},A.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},A.prototype._init=function(){this._result=new Array(this.length)};var U=A;A.prototype._enumerate=function(){for(var t=this.length,n=this.promise,e=this._input,r=0;n._state===k&&t>r;r++)this._eachEntry(e[r],r)},A.prototype._eachEntry=function(t,n){var e=this._instanceConstructor;r(t)?t.constructor===e&&t._state!==k?(t._onerror=null,this._settledAt(t._state,n,t._result)):this._willSettleAt(e.resolve(t),n):(this._remaining--,this._result[n]=this._makeResult($,n,t))},A.prototype._settledAt=function(t,n,e){var r=this.promise;r._state===k&&(this._remaining--,this._abortOnReject&&t===W?E(r,e):this._result[n]=this._makeResult(t,n,e)),0===this._remaining&&b(r,this._result)},A.prototype._makeResult=function(t,n,e){return e},A.prototype._willSettleAt=function(t,n){var e=this;D(t,void 0,function(t){e._settledAt($,n,t)},function(t){e._settledAt(W,n,t)})};var Q=function(t,n){return new U(this,t,!0,n).promise},Y=function(t,n){function e(t){_(o,t)}function r(t){E(o,t)}var i=this,o=new i(l,n);if(!q(t))return E(o,new TypeError("You must pass an array to race.")),o;for(var s=t.length,u=0;o._state===k&&s>u;u++)D(i.resolve(t[u]),void 0,e,r);return o},K=function(t,n){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var r=new e(l,n);return _(r,t),r},J=function(t,n){var e=this,r=new e(l,n);return E(r,t),r},V=0,X=T;T.all=Q,T.race=Y,T.resolve=K,T.reject=J,T.prototype={constructor:T,then:function(t,n){var e=this,r=e._state;if(r===$&&!t||r===W&&!n)return this;var i=new this.constructor(l),o=e._result;if(r){var s=arguments[r-1];B(function(){j(r,i,s,o)})}else D(e,i,t,n);return i},"catch":function(t){return this.then(null,t)}};var Z=function(){var t;t="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;var e="Promise"in t&&"resolve"in t.Promise&&"reject"in t.Promise&&"all"in t.Promise&&"race"in t.Promise&&function(){var e;return new t.Promise(function(t){e=t}),n(e)}();e||(t.Promise=X)},tn={Promise:X,polyfill:Z};"function"==typeof define&&define.amd?define(function(){return tn}):"undefined"!=typeof e&&e.exports?e.exports=tn:"undefined"!=typeof this&&(this.ES6Promise=tn)}).call(this)}),require.register("eventric/index",function(t,n,e){n("es6-promise").polyfill(),e.exports=new(n("./eventric"))}),require.register("eventric/aggregate/aggregate",function(t,n,e){var r,i=function(t,n){return function(){return t.apply(n,arguments)}};r=function(){function t(t,n,e,r){this._context=t,this._eventric=n,this._name=e,this.getDomainEvents=i(this.getDomainEvents,this),this.emitDomainEvent=i(this.emitDomainEvent,this),this._domainEvents=[],this.root=r?new r:{},this.root.$emitDomainEvent=this.emitDomainEvent}return t.prototype.emitDomainEvent=function(t,n){var e,r,i;if(e=this._context.getDomainEvent(t),!e)throw i="Tried to emitDomainEvent '"+t+"' which is not defined",this._eventric.log.error(i),new Error(i);return r=this._createDomainEvent(t,e,n),this._domainEvents.push(r),this._handleDomainEvent(t,r),this._eventric.log.debug("Created and Handled DomainEvent in Aggregate",r)},t.prototype._createDomainEvent=function(t,n,e){return new this._eventric.DomainEvent({id:this._eventric.generateUid(),name:t,aggregate:{id:this.id,name:this._name},context:this._context.name,payload:new n(e)})},t.prototype._handleDomainEvent=function(t,n){return this.root["handle"+t]?this.root["handle"+t](n,function(){}):this._eventric.log.debug("Tried to handle the DomainEvent '"+t+"' without a matching handle method")},t.prototype.getDomainEvents=function(){return this._domainEvents},t.prototype.applyDomainEvents=function(t){var n,e,r,i;for(i=[],e=0,r=t.length;r>e;e++)n=t[e],i.push(this._applyDomainEvent(n));return i},t.prototype._applyDomainEvent=function(t){return this._handleDomainEvent(t.name,t)},t}(),e.exports=r}),require.register("eventric/aggregate/index",function(t,n,e){e.exports=n("./aggregate")}),require.register("eventric/context/context",function(t,n,e){var r,i=function(t,n){return function(){return t.apply(n,arguments)}},o=[].slice;r=function(){function t(t,n){this.name=t,this._eventric=n,this.clearProjectionStore=i(this.clearProjectionStore,this),this.getProjectionStore=i(this.getProjectionStore,this),this._getAggregateRepository=i(this._getAggregateRepository,this),this.publishDomainEvent=i(this.publishDomainEvent,this),this.emitDomainEvent=i(this.emitDomainEvent,this),this._initialized=!1,this._params=this._eventric.get(),this._di={},this._aggregateRootClasses={},this._adapterClasses={},this._adapterInstances={},this._commandHandlers={},this._queryHandlers={},this._domainEventClasses={},this._domainEventHandlers={},this._projectionClasses={},this._domainEventStreamClasses={},this._domainEventStreamInstances={},this._repositoryInstances={},this._domainServices={},this._storeClasses={},this._storeInstances={},this._eventBus=new this._eventric.EventBus(this._eventric),this.projectionService=new this._eventric.Projection(this._eventric),this.log=this._eventric.log}return t.prototype.set=function(t,n){return this._params[t]=n,this},t.prototype.get=function(t){return this._params[t]},t.prototype.emitDomainEvent=function(t,n){var e,r;if(e=this.getDomainEvent(t),!e)throw new Error("Tried to emitDomainEvent '"+t+"' which is not defined");return r=this._createDomainEvent(t,e,n),this.saveAndPublishDomainEvent(r).then(function(t){return function(){return t._eventric.log.debug("Created and Handled DomainEvent in Context",r)}}(this))},t.prototype.publishDomainEvent=function(t){return this._eventBus.publishDomainEvent(t)},t.prototype._createDomainEvent=function(t,n,e){return new this._eventric.DomainEvent({id:this._eventric.generateUid(),name:t,context:this.name,payload:new n(e)})},t.prototype.addStore=function(t,n,e){return null==e&&(e={}),this._storeClasses[t]={Class:n,options:e},this},t.prototype.defineDomainEvent=function(t,n){return this._domainEventClasses[t]=n,this},t.prototype.defineDomainEvents=function(t){var n,e;for(e in t)n=t[e],this.defineDomainEvent(e,n);return this},t.prototype.addCommandHandler=function(t,n){return this._commandHandlers[t]=n,this},t.prototype._getAggregateRepository=function(t,n){var e,r,i;return r||(r={}),r[t]||(e=this._aggregateRootClasses[t],i=new this._eventric.Repository({aggregateName:t,AggregateRoot:e,context:this,eventric:this._eventric}),r[t]=i),r[t].setCommand(n),r[t]},t.prototype.addCommandHandlers=function(t){var n,e;for(e in t)n=t[e],this.addCommandHandler(e,n);return this},t.prototype.addQueryHandler=function(t,n){return this._queryHandlers[t]=n,this},t.prototype.addQueryHandlers=function(t){var n,e;for(e in t)n=t[e],this.addQueryHandler(e,n);return this},t.prototype.addAggregate=function(t,n){return this._aggregateRootClasses[t]=n,this},t.prototype.addAggregates=function(t){var n,e;for(e in t)n=t[e],this.addAggregate(e,n);return this},t.prototype.subscribeToDomainEvent=function(t,n,e){var r;return null==e&&(e={}),r=function(t){return function(){return n.apply(t._di,arguments)}}(this),this._eventBus.subscribeToDomainEvent(t,r,e)},t.prototype.subscribeToDomainEvents=function(t){var n,e,r;r=[];for(n in t)e=t[n],r.push(this.subscribeToDomainEvent(n,e));return r},t.prototype.subscribeToDomainEventWithAggregateId=function(t,n,e,r){var i;return null==r&&(r={}),i=function(t){return function(){return e.apply(t._di,arguments)}}(this),this._eventBus.subscribeToDomainEventWithAggregateId(t,n,i,r)},t.prototype.subscribeToAllDomainEvents=function(t,n){var e;return null==n&&(n={}),e=function(n){return function(){return t.apply(n._di,arguments)}}(this),this._eventBus.subscribeToAllDomainEvents(e,n)},t.prototype.subscribeToDomainEventStream=function(t,n,e){return null==e&&(e={}),new Promise(function(r){return function(i,o){var s,u,a,c,l,p,f;if(!r._domainEventStreamClasses[t])return l=new Error("DomainEventStream Class with name "+t+" not added"),r.log.error(l),o(l);a=new r._domainEventStreamClasses[t],a._domainEventsPublished={},c=r._eventric.generateUid(),r._domainEventStreamInstances[c]=a,u=[];for(p in a)f=a[p],0===p.indexOf("filter")&&"function"==typeof f&&(s=p.replace(/^filter/,""),u.push(s));return r._applyDomainEventsFromStoreToDomainEventStream(u,a,n).then(function(){var t,i,o;for(o=[],t=0,i=u.length;i>t;t++)s=u[t],o.push(r.subscribeToDomainEvent(s,function(t){return a._domainEventsPublished[t.id]?void 0:a["filter"+t.name](t)===!0?n(t,function(){}):void 0},e));return o})["catch"](function(t){return o(t)}),i(c)}}(this))},t.prototype._applyDomainEventsFromStoreToDomainEventStream=function(t,n){return new Promise(function(e){return function(r,i){return e.findDomainEventsByName(t).then(function(o){return o&&0!==o.length?e._eventric.eachSeries(o,function(t,e){return n["filter"+t.name](t)===!0?(handlerFn(t,function(){}),n._domainEventsPublished[t.id]=!0,e()):void 0},function(n){return n?i(n):r(t)}):r(t)})["catch"](function(t){return i(t)})}}(this))},t.prototype.addDomainService=function(t,n){return this._domainServices[t]=function(t){return function(){return n.apply(t._di,arguments)}}(this),this},t.prototype.addDomainServices=function(t){var n,e;for(e in t)n=t[e],this.addDomainService(e,n);return this},t.prototype.addAdapter=function(t,n){return this._adapterClasses[t]=n,this},t.prototype.addAdapters=function(t){var n,e;for(n in t)e=t[n],this.addAdapter(n,e);return this},t.prototype.addProjection=function(t,n){return this._projectionClasses[t]=n,this},t.prototype.addProjections=function(t){var n,e;for(e in t)n=t[e],this.addProjection(e,n);return this},t.prototype.addDomainEventStream=function(t,n){return this._domainEventStreamClasses[t]=n,this},t.prototype.addDomainEventStreams=function(t){var n,e;for(e in t)n=t[e],this.addDomainEventStream(e,n);return this},t.prototype.getProjectionInstance=function(t){return this.projectionService.getInstance(t)},t.prototype.destroyProjectionInstance=function(t){return this.projectionService.destroyInstance(t,this)},t.prototype.initializeProjectionInstance=function(t,n){var e;return this._projectionClasses[t]?this.projectionService.initializeInstance(t,this._projectionClasses[t],n,this):(e="Given projection "+t+" not registered on context",this._eventric.log.error(e),e=new Error(e))},t.prototype.initialize=function(){return new Promise(function(t){return function(n,e){return t.log.debug("["+t.name+"] Initializing"),t.log.debug("["+t.name+"] Initializing Store"),t._initializeStores().then(function(){return t.log.debug("["+t.name+"] Finished initializing Store"),t._di={$adapter:function(){return t.getAdapter.apply(t,arguments)},$query:function(){return t.query.apply(t,arguments)},$domainService:function(){return t.getDomainService(arguments[0]).apply(t,[arguments[1],arguments[2]])},$projectionStore:function(){return t.getProjectionStore.apply(t,arguments)},$emitDomainEvent:function(){return t.emitDomainEvent.apply(t,arguments)}},t.log.debug("["+t.name+"] Initializing Adapters"),t._initializeAdapters()}).then(function(){return t.log.debug("["+t.name+"] Finished initializing Adapters"),t.log.debug("["+t.name+"] Initializing Projections"),t._initializeProjections()}).then(function(){return t.log.debug("["+t.name+"] Finished initializing Projections"),t.log.debug("["+t.name+"] Finished initializing"),t._initialized=!0,n()})["catch"](function(t){return e(t)})}}(this))},t.prototype._initializeStores=function(){return new Promise(function(t){return function(n,e){var r,i,o,s;o=[],s=t._eventric.defaults(t._storeClasses,t._eventric.getStores());for(i in s)r=s[i],o.push({name:i,Class:r.Class,options:r.options});return t._eventric.eachSeries(o,function(n,e){return t.log.debug("["+t.name+"] Initializing Store "+n.name),t._storeInstances[n.name]=new n.Class,t._storeInstances[n.name].initialize(t,n.options).then(function(){return t.log.debug("["+t.name+"] Finished initializing Store "+n.name),e()})["catch"](function(t){return e(t)})},function(t){return t?e(t):n()})}}(this))},t.prototype._initializeProjections=function(){return new Promise(function(t){return function(n,e){var r,i,o,s;o=[],s=t._projectionClasses;for(i in s)r=s[i],o.push({name:i,"class":r});return t._eventric.eachSeries(o,function(n,r){var i;return i=null,t.log.debug("["+t.name+"] Initializing Projection "+n.name),t.projectionService.initializeInstance(n.name,n["class"],{},t).then(function(){return t.log.debug("["+t.name+"] Finished initializing Projection "+n.name),r()})["catch"](function(t){return e(t)})},function(t){return t?e(t):n()})}}(this))},t.prototype._initializeAdapters=function(){return new Promise(function(t){return function(n){var e,r,i,o;o=t._adapterClasses;for(i in o)r=o[i],e=new t._adapterClasses[i],"function"==typeof e.initialize&&e.initialize(),t._adapterInstances[i]=e;return n()}}(this))},t.prototype.getProjection=function(t){return this.projectionService.getInstance(t)},t.prototype.getAdapter=function(t){return this._adapterInstances[t]},t.prototype.getDomainEvent=function(t){return this._domainEventClasses[t]},t.prototype.getDomainService=function(t){return this._domainServices[t]},t.prototype.getDomainEventsStore=function(){var t;return t=this.get("default domain events store"),this._storeInstances[t]},t.prototype.saveAndPublishDomainEvent=function(t){return new Promise(function(n){return function(e,r){return n.getDomainEventsStore().saveDomainEvent(t).then(function(){return n.publishDomainEvent(t)}).then(function(n){return n?r(n):e(t)})}}(this))},t.prototype.findAllDomainEvents=function(){return new Promise(function(t){return function(n,e){return t.getDomainEventsStore().findAllDomainEvents(function(t,r){return t?e(t):n(r)})}}(this))},t.prototype.findDomainEventsByName=function(){var t;return t=1<=arguments.length?o.call(arguments,0):[],new Promise(function(n){return function(e,r){var i;return(i=n.getDomainEventsStore()).findDomainEventsByName.apply(i,o.call(t).concat([function(t,n){return t?r(t):e(n)}]))}}(this))},t.prototype.findDomainEventsByAggregateId=function(){var t;return t=1<=arguments.length?o.call(arguments,0):[],new Promise(function(n){return function(e,r){var i;return(i=n.getDomainEventsStore()).findDomainEventsByAggregateId.apply(i,o.call(t).concat([function(t,n){return t?r(t):e(n)}]))}}(this))},t.prototype.findDomainEventsByNameAndAggregateId=function(){var t;return t=1<=arguments.length?o.call(arguments,0):[],new Promise(function(n){return function(e,r){var i;return(i=n.getDomainEventsStore()).findDomainEventsByNameAndAggregateId.apply(i,o.call(t).concat([function(t,n){return t?r(t):e(n)}]))}}(this))},t.prototype.findDomainEventsByAggregateName=function(){var t;return t=1<=arguments.length?o.call(arguments,0):[],new Promise(function(n){return function(e,r){var i;return(i=n.getDomainEventsStore()).findDomainEventsByAggregateName.apply(i,o.call(t).concat([function(t,n){return t?r(t):e(n)}]))}}(this))},t.prototype.getProjectionStore=function(t,n){return new Promise(function(e){return function(r,i){var o;return e._storeInstances[t]?e._storeInstances[t].getProjectionStore(n).then(function(t){return r(t)})["catch"](function(t){return i(t)}):(o="Requested Store with name "+t+" not found",e.log.error(o),i(o))}}(this))},t.prototype.clearProjectionStore=function(t,n){return new Promise(function(e){return function(r,i){var o;return e._storeInstances[t]?e._storeInstances[t].clearProjectionStore(n).then(function(){return r()})["catch"](function(t){return i(t)}):(o="Requested Store with name "+t+" not found",e.log.error(o),i(o))}}(this))},t.prototype.getEventBus=function(){return this._eventBus},t.prototype.command=function(t,n){return new Promise(function(e){return function(r,i){var s,u,a,c,l,p,f,h;if(s={id:e._eventric.generateUid(),name:t,params:n},e.log.debug("Got Command",s),!e._initialized)return p="Context not initialized yet",e.log.error(p),p=new Error(p),i(p);if(!e._commandHandlers[t])return p="Given command "+t+" not registered on context",e.log.error(p),p=new Error(p),i(p);f={},h=e._di;for(l in h)c=h[l],f[l]=c;if(f.$aggregate={create:function(){var t,n,r;return t=arguments[0],n=2<=arguments.length?o.call(arguments,1):[],r=e._getAggregateRepository(t,s),r.create.apply(r,n)},load:function(t,n){var r;return r=e._getAggregateRepository(t,s),r.findById(n)}},a=null,u=e._commandHandlers[t],u.length<=1){if(a=u.apply(f,[n]),!(a instanceof Promise))return p="CommandHandler "+t+" didnt return a promise and no promise argument defined.",e.log.error(p),i(p)}else a=new Promise(function(t,e){return u.apply(f,[n,{resolve:t,reject:e}])});return a.then(function(n){return e.log.debug("Completed Command",t),r(n)})["catch"](function(t){return i(t)})}}(this))},t.prototype.query=function(t,n){return new Promise(function(e){return function(r,i){var o,s;return e.log.debug("Got Query",t),e._initialized?e._queryHandlers[t]?(s=e._queryHandlers[t].length<=1?e._queryHandlers[t].apply(e._di,[n]):new Promise(function(r,i){return e._queryHandlers[t].apply(e._di,[n,{resolve:r,reject:i}])}),s.then(function(n){return e.log.debug("Completed Query "+t+" with Result "+n),r(n)})["catch"](function(t){return i(t)})):(o="Given query "+t+" not registered on context",e.log.error(o),o=new Error(o),i(o)):(o="Context not initialized yet",e.log.error(o),o=new Error(o),void i(o))}}(this))},t.prototype.enableWaitingMode=function(){return this.set("waiting mode",!0)},t.prototype.disableWaitingMode=function(){return this.set("waiting mode",!1)},t.prototype.isWaitingModeEnabled=function(){return this.get("waiting mode")},t}(),e.exports=r}),require.register("eventric/context/index",function(t,n,e){e.exports=n("./context")}),require.register("eventric/domain_event/domain_event",function(t,n,e){var r;r=function(){function t(t){this.id=t.id,this.name=t.name,this.payload=t.payload,this.aggregate=t.aggregate,this.context=t.context,this.timestamp=(new Date).getTime()}return t}(),e.exports=r}),require.register("eventric/domain_event/index",function(t,n,e){e.exports=n("./domain_event")}),require.register("eventric/event_bus/event_bus",function(t,n,e){var r;r=function(){function t(t){this._eventric=t,this._pubSub=new this._eventric.PubSub}return t.prototype.subscribeToDomainEvent=function(t,n,e){return null==e&&(e={}),e.isAsync?this._pubSub.subscribeAsync(t,n):this._pubSub.subscribe(t,n)},t.prototype.subscribeToDomainEventWithAggregateId=function(t,n,e,r){return null==r&&(r={}),this.subscribeToDomainEvent(""+t+"/"+n,e,r)},t.prototype.subscribeToAllDomainEvents=function(t){return this._pubSub.subscribe("DomainEvent",t)},t.prototype.publishDomainEvent=function(t){return this._publish("publish",t)},t.prototype.publishDomainEventAndWait=function(t){return this._publish("publishAsync",t)},t.prototype._publish=function(t,n){return new Promise(function(e){return function(r,i){return e._pubSub[t]("DomainEvent",n).then(function(){return e._pubSub[t](n.name,n)}).then(function(){return n.aggregate&&n.aggregate.id?e._pubSub[t](""+n.name+"/"+n.aggregate.id,n).then(function(){return r()}):r()})["catch"](function(t){return i(t)})}}(this))},t}(),e.exports=r}),require.register("eventric/event_bus/index",function(t,n,e){e.exports=n("./event_bus")}),require.register("eventric/process_manager/index",function(t,n,e){e.exports=n("./process_manager")}),require.register("eventric/process_manager/process_manager",function(t,n,e){var r;r=function(){function t(){this._processManagerInstances={}}return t.prototype.add=function(t,n,e){var r,i,o,s,u;s=n.initializeWhen,u=[];for(r in s)o=s[r],u.push(function(){var s,u,a;for(a=[],s=0,u=o.length;u>s;s++)i=o[s],a.push(e.subscribeToDomainEvent(r,i,function(i){return function(o){return i._spawnProcessManager(t,n["class"],r,o,e)}}(this)));return a}.call(this));return u},t.prototype._spawnProcessManager=function(t,n,e,r,i){var o,s,u,a,c,l,p;a=i.generateUid(),u=new n,u.$endProcess=function(n){return function(){return n._endProcessManager(t,a)}}(this),o=[];for(s in u)c=u[s],0===s.indexOf("from")&&"function"==typeof c&&o.push(s);return this._subscribeProcessManagerToDomainEvents(u,o,i),u.initialize(r),null==(l=this._processManagerInstances)[t]&&(l[t]={}),null==(p=this._processManagerInstances[t])[a]&&(p[a]={}),this._processManagerInstances[t][a]=u},t.prototype._endProcessManager=function(t,n){return delete this._processManagerInstances[t][n]},t.prototype._subscribeProcessManagerToDomainEvents=function(t,n,e){return e.subscribeToDomainEvent(function(e){return function(r){var i,o,s,u;for(u=[],o=0,s=n.length;s>o;o++)i=n[o],u.push("from"+r.context+"_handle"+r.name===i?e._applyDomainEventToProcessManager(i,r,t):void 0);return u}}(this))},t.prototype._applyDomainEventToProcessManager=function(t,n,e){var r;return e[t]?e[t](n):r=new Error("Tried to apply DomainEvent '"+domainEventName+"' to Projection without a matching handle method")},t}(),e.exports=new r}),require.register("eventric/logger/index",function(t,n,e){e.exports=n("./logger")}),require.register("eventric/logger/logger",function(t,n,e){e.exports={_logLevel:1,setLogLevel:function(t){return this._logLevel=function(){switch(t){case"debug":return 0;case"warn":return 1;case"info":return 2;case"error":return 3}}()},debug:function(){return this._logLevel>0?void 0:console.log.apply(console,arguments)},warn:function(){return this._logLevel>1?void 0:console.log.apply(console,arguments)},info:function(){return this._logLevel>2?void 0:console.log.apply(console,arguments)},error:function(){return this._logLevel>3?void 0:console.log.apply(console,arguments)}}}),require.register("eventric/projection/index",function(t,n,e){e.exports=n("./projection")}),require.register("eventric/projection/projection",function(t,n,e){var r,i=function(t,n){return function(){return t.apply(n,arguments)}};r=function(){function t(t){this._eventric=t,this._applyDomainEventToProjection=i(this._applyDomainEventToProjection,this),this.log=this._eventric.log,this._handlerFunctions={},this._projectionInstances={},this._domainEventsApplied={}}return t.prototype.initializeInstance=function(t,n,e,r){return this._context=r,new Promise(function(r){return function(i,o){var s,u,a,c,l,p,f;if(l="function"==typeof n?new n:n,r._context._di){f=r._context._di;for(a in f)u=f[a],l[a]=u}return p=r._eventric.generateUid(),s=null,l.$subscribeHandlersWithAggregateId=function(t){return s=t},c=null,l.$subscribeToDomainEventStream=function(t){return c=t},r.log.debug("["+r._context.name+"] Clearing ProjectionStores "+l.stores+" of "+t),r._clearProjectionStores(l.stores,t).then(function(){return r.log.debug("["+r._context.name+"] Finished clearing ProjectionStores of "+t),r._injectStoresIntoProjection(t,l)
}).then(function(){return r._callInitializeOnProjection(t,l,e)}).then(function(){return r.log.debug("["+r._context.name+"] Replaying DomainEvents against Projection "+t),r._parseEventNamesFromProjection(l)}).then(function(t){return r._applyDomainEventsFromStoreToProjection(p,l,t,s)}).then(function(n){return r.log.debug("["+r._context.name+"] Finished Replaying DomainEvents against Projection "+t),r._subscribeProjectionToDomainEvents(p,t,l,n,s,c)}).then(function(){var n;return r._projectionInstances[p]=l,n={id:p,projection:l},r._context.publish("projection:"+t+":initialized",n),r._context.publish("projection:"+p+":initialized",n),i(p)})["catch"](function(t){return o(t)})}}(this))},t.prototype._callInitializeOnProjection=function(t,n,e){return new Promise(function(r){return function(i){return n.initialize?(r.log.debug("["+r._context.name+"] Calling initialize on Projection "+t),n.initialize(e,function(){return r.log.debug("["+r._context.name+"] Finished initialize call on Projection "+t),i(n)})):(r.log.debug("["+r._context.name+"] No initialize function on Projection "+t+" given, skipping"),i(n))}}(this))},t.prototype._injectStoresIntoProjection=function(t,n){return new Promise(function(e){return function(r,i){return n.stores?(null==n.$store&&(n.$store={}),e._eventric.eachSeries(n.stores,function(r,i){return e.log.debug("["+e._context.name+"] Injecting ProjectionStore "+r+" into Projection "+t),e._context.getProjectionStore(r,t).then(function(o){return o?(n.$store[r]=o,e.log.debug("["+e._context.name+"] Finished Injecting ProjectionStore "+r+" into Projection "+t),i()):void 0})["catch"](function(t){return i(t)})},function(t){return t?i(t):r()})):r()}}(this))},t.prototype._clearProjectionStores=function(t,n){return new Promise(function(e){return function(r){return t?e._eventric.eachSeries(t,function(t,r){return e.log.debug("["+e._context.name+"] Clearing ProjectionStore "+t+" for "+n),e._context.clearProjectionStore(t,n).then(function(){return e.log.debug("["+e._context.name+"] Finished clearing ProjectionStore "+t+" for "+n),r()})["catch"](function(t){return r(t)})},function(){return r()}):r()}}(this))},t.prototype._parseEventNamesFromProjection=function(t){return new Promise(function(){return function(n){var e,r,i,o;r=[];for(i in t)o=t[i],0===i.indexOf("handle")&&"function"==typeof o&&(e=i.replace(/^handle/,""),r.push(e));return n(r)}}(this))},t.prototype._applyDomainEventsFromStoreToProjection=function(t,n,e,r){return new Promise(function(i){return function(o,s){var u;return i._domainEventsApplied[t]={},u=r?i._context.findDomainEventsByNameAndAggregateId(e,r):i._context.findDomainEventsByName(e),u.then(function(r){return r&&0!==r.length?i._eventric.eachSeries(r,function(e,r){return i._applyDomainEventToProjection(e,n).then(function(){return i._domainEventsApplied[t][e.id]=!0,r()})},function(t){return t?s(t):o(e)}):o(e)})["catch"](function(t){return s(t)})}}(this))},t.prototype._subscribeProjectionToDomainEvents=function(t,n,e,r,i,o){return new Promise(function(s){return function(u,a){var c;return c=function(r,i){return null==i&&(i=function(){}),s._domainEventsApplied[t][r.id]?i():s._applyDomainEventToProjection(r,e).then(function(){var o;return s._domainEventsApplied[t][r.id]=!0,o={id:t,projection:e,domainEvent:r},s._context.publish("projection:"+n+":changed",o),s._context.publish("projection:"+t+":changed",o),i()})["catch"](function(t){return i(t)})},o?s._context.subscribeToDomainEventStream(o,c,{isAsync:!0}).then(function(n){var e;return null==(e=s._handlerFunctions)[t]&&(e[t]=[]),s._handlerFunctions[t].push(n),u()})["catch"](function(t){return a(t)}):s._eventric.eachSeries(r,function(n,e){var r;return r=i?s._context.subscribeToDomainEventWithAggregateId(n,i,c,{isAsync:!0}):s._context.subscribeToDomainEvent(n,c,{isAsync:!0}),r.then(function(n){var r;return null==(r=s._handlerFunctions)[t]&&(r[t]=[]),s._handlerFunctions[t].push(n),e()})["catch"](function(t){return e(t)})},function(t){return t?a(t):u()})}}(this))},t.prototype._applyDomainEventToProjection=function(t,n){return new Promise(function(e){return function(r,i){return n["handle"+t.name]?2===n["handle"+t.name].length?n["handle"+t.name](t,{resolve:r,reject:i}):(n["handle"+t.name](t),r()):(e.log.debug("Tried to apply DomainEvent '"+t.name+"' to Projection without a matching handle method"),r())}}(this))},t.prototype.getInstance=function(t){return this._projectionInstances[t]},t.prototype.destroyInstance=function(t){var n,e,r,i,o;if(!this._handlerFunctions[t])return this._eventric.log.error("Missing attribute projectionId");for(e=[],o=this._handlerFunctions[t],r=0,i=o.length;i>r;r++)n=o[r],e.push(this._context.unsubscribeFromDomainEvent(n));return delete this._handlerFunctions[t],delete this._projectionInstances[t],Promise.all(e)},t}(),e.exports=r}),require.register("eventric/pub_sub/index",function(t,n,e){e.exports=n("./pub_sub")}),require.register("eventric/pub_sub/pub_sub",function(t,n,e){var r,i=[].slice;r=function(){function t(){this._subscribers=[],this._subscriberId=0,this._nextTick=function(){var t;return t=1<=arguments.length?i.call(arguments,0):[],setTimeout.apply(null,t)}}return t.prototype.subscribe=function(t,n){return new Promise(function(e){return function(r){var i;return i={eventName:t,subscriberFn:n,subscriberId:e._getNextSubscriberId()},e._subscribers.push(i),r(i.subscriberId)}}(this))},t.prototype.subscribeAsync=function(t,n){return new Promise(function(e){return function(r){var i;return i={eventName:t,subscriberFn:n,subscriberId:e._getNextSubscriberId(),isAsync:!0},e._subscribers.push(i),r(i.subscriberId)}}(this))},t.prototype.publish=function(t,n){return new Promise(function(e){return function(r){var i,o;return o=e._getRelevantSubscribers(t),i=function(){return 0===o.length?r():(o.shift().subscriberFn(n,function(){}),e._nextTick(i,0))},e._nextTick(i,0)}}(this))},t.prototype.publishAsync=function(t,n){return new Promise(function(e){return function(r){var i,o;return o=e._getRelevantSubscribers(t),i=function(){var t;return 0===o.length?r():(t=o.shift(),t.isAsync?t.subscriberFn(n,function(){return setTimeout(i,0)}):(t.subscriberFn(n),e._nextTick(i,0)))},e._nextTick(i,0)}}(this))},t.prototype._getRelevantSubscribers=function(t){return t?this._subscribers.filter(function(n){return n.eventName===t}):this._subscribers},t.prototype.unsubscribe=function(t){return new Promise(function(n){return function(e){return n._subscribers=n._subscribers.filter(function(n){return n.subscriberId!==t}),e()}}(this))},t.prototype._getNextSubscriberId=function(){return this._subscriberId++},t}(),e.exports=r}),require.register("eventric/remote/index",function(t,n,e){e.exports=n("./remote")}),require.register("eventric/remote/remote",function(t,n,e){var r;r=function(){function t(t,e){this._contextName=t,this._eventric=e,this.name=this._contextName,this.InMemoryRemote=n("./inmemory"),this._params={},this._clients={},this._projectionClasses={},this._projectionInstances={},this._handlerFunctions={},this.projectionService=new this._eventric.Projection(this._eventric),this.addClient("inmemory",this.InMemoryRemote.client),this.set("default client","inmemory")}return t.prototype.set=function(t,n){return this._params[t]=n,this},t.prototype.get=function(t){return this._params[t]},t.prototype.command=function(){return this._rpc("command",arguments)},t.prototype.query=function(){return this._rpc("query",arguments)},t.prototype.findAllDomainEvents=function(){return this._rpc("findAllDomainEvents",arguments)},t.prototype.findDomainEventsByName=function(){return this._rpc("findDomainEventsByName",arguments)},t.prototype.findDomainEventsByAggregateId=function(){return this._rpc("findDomainEventsByAggregateId",arguments)},t.prototype.findDomainEventsByAggregateName=function(){return this._rpc("findDomainEventsByAggregateName",arguments)},t.prototype.findDomainEventsByNameAndAggregateId=function(){return this._rpc("findDomainEventsByNameAndAggregateId",arguments)},t.prototype.subscribeToAllDomainEvents=function(t,n){var e,r;return null==n&&(n={}),r=this.get("default client"),e=this.getClient(r),e.subscribe(this._contextName,t)},t.prototype.subscribeToDomainEvent=function(t,n,e){var r,i;return null==e&&(e={}),i=this.get("default client"),r=this.getClient(i),r.subscribe(this._contextName,t,n)},t.prototype.subscribeToDomainEventWithAggregateId=function(t,n,e,r){var i,o;return null==r&&(r={}),o=this.get("default client"),i=this.getClient(o),i.subscribe(this._contextName,t,n,e)},t.prototype.subscribeToDomainEventStream=function(){return this._rpc("subscribeToDomainEventStream",arguments)},t.prototype.unsubscribeFromDomainEvent=function(t){var n,e;return e=this.get("default client"),n=this.getClient(e),n.unsubscribe(t)},t.prototype._rpc=function(t,n){return new Promise(function(e){return function(r,i){var o,s;return s=e.get("default client"),o=e.getClient(s),o.rpc({contextName:e._contextName,method:t,params:Array.prototype.slice.call(n)},function(t,n){return t?i(t):r(n)})}}(this))},t.prototype.addClient=function(t,n){return this._clients[t]=n,this},t.prototype.getClient=function(t){return this._clients[t]},t.prototype.addProjection=function(t,n){return this._projectionClasses[t]=n,this},t.prototype.initializeProjection=function(t,n){return this.projectionService.initializeInstance("",t,n,this)},t.prototype.initializeProjectionInstance=function(t,n){var e;return this._projectionClasses[t]?this.projectionService.initializeInstance(t,this._projectionClasses[t],n,this):(e="Given projection "+t+" not registered on remote",this._eventric.log.error(e),e=new Error(e))},t.prototype.getProjectionInstance=function(t){return this.projectionService.getInstance(t)},t.prototype.destroyProjectionInstance=function(t){return this.projectionService.destroyInstance(t,this)},t}(),e.exports=r}),require.register("eventric/repository/index",function(t,n,e){e.exports=n("./repository")}),require.register("eventric/repository/repository",function(t,n,e){var r,i=function(t,n){return function(){return t.apply(n,arguments)}};r=function(){function t(t,n){this._eventric=n,this.save=i(this.save,this),this.create=i(this.create,this),this.findById=i(this.findById,this),this._aggregateName=t.aggregateName,this._AggregateRoot=t.AggregateRoot,this._context=t.context,this._eventric=t.eventric,this._command={},this._aggregateInstances={},this._store=this._context.getDomainEventsStore()}return t.prototype.findById=function(t,n){return null==n&&(n=function(){}),new Promise(function(e){return function(r,i){return e._findDomainEventsForAggregate(t,function(o,s){var u,a,c,l;return o?(n(o,null),void i(o)):s.length?(u=new e._eventric.Aggregate(e._context,e._eventric,e._aggregateName,e._AggregateRoot),u.applyDomainEvents(s),u.id=t,u.root.$id=t,u.root.$save=function(){return e.save(u.id)},a=null!=(l=e._command.id)?l:"nocommand",null==(c=e._aggregateInstances)[a]&&(c[a]={}),e._aggregateInstances[a][t]=u,n(null,u.root),r(u.root)):(o="No domainEvents for "+e._aggregateName+" Aggregate with "+t+" available",e._eventric.log.error(o),n(o,null),void i(o))})}}(this))},t.prototype._findDomainEventsForAggregate=function(t,n){return this._store.findDomainEventsByAggregateId(t,function(){return function(t,e){return t?n(t,null):0===e.length?n(null,[]):n(null,e)}}(this))},t.prototype.create=function(t){return new Promise(function(n){return function(e,r){var i,o,s,u,a,c;return i=new n._eventric.Aggregate(n._context,n._eventric,n._aggregateName,n._AggregateRoot),i.id=n._eventric.generateUid(),"function"!=typeof i.root.create&&(u="No create function on aggregate",n._eventric.log.error(u),r(new Error(u))),i.root.$id=i.id,i.root.$save=function(){return n.save(i.id)},o=null!=(c=n._command.id)?c:"nocommand",null==(a=n._aggregateInstances)[o]&&(a[o]={}),n._aggregateInstances[o][i.id]=i,s=new Promise(function(n,e){return i.root.create.length<=1?(i.root.create(t),n()):i.root.create(t,{resolve:n,reject:e})}),s.then(function(){return e(i.root)})["catch"](function(t){return r(t)})}}(this))},t.prototype.save=function(t,n){return null==n&&(n=function(){}),new Promise(function(e){return function(r,i){var o,s,u,a,c;return s=null!=(c=e._command.id)?c:"nocommand",(o=e._aggregateInstances[s][t])?(u=o.getDomainEvents(),u.length<1?(a="Tried to save 0 DomainEvents from Aggregate "+e._aggregateName,e._eventric.log.debug(a,e._command),a=new Error(a),"function"==typeof n&&n(a,null),void i(a)):(e._eventric.log.debug("Going to Save and Publish "+u.length+" DomainEvents from Aggregate "+e._aggregateName),e._eventric.eachSeries(u,function(t,n){return t.command=e._command,e._store.saveDomainEvent(t).then(function(){return e._eventric.log.debug("Saved DomainEvent",t),n(null)})},function(t){var s,a,c;if(t)return n(t,null),i(t);if(e._context.isWaitingModeEnabled())return e._eventric.eachSeries(u,function(t,n){return e._eventric.log.debug("Publishing DomainEvent in waiting mode",t),e._context.getEventBus().publishDomainEventAndWait(t).then(function(){return n()})},function(t){return t?(n(t,null),i(t)):(r(o.id),n(null,o.id))});for(a=0,c=u.length;c>a;a++)s=u[a],e._eventric.log.debug("Publishing DomainEvent",s),e._context.getEventBus().publishDomainEvent(s);return r(o.id),n(null,o.id)}))):(a="Tried to save unknown aggregate "+e._aggregateName,e._eventric.log.error(a),a=new Error(a),"function"==typeof n&&n(a,null),void i(a))}}(this))},t.prototype.setCommand=function(t){return this._command=t},t}(),e.exports=r}),require.register("eventric/remote/inmemory/index",function(t,n,e){e.exports=n("./remote_inmemory")}),require.register("eventric/remote/inmemory/remote_inmemory",function(t,n,e){var r,i,o,s,u,a,c=[].slice;o=n("../../pub_sub"),s=null,a=new o,i=function(){function t(){s=function(t){return function(n){return new Promise(function(e,r){return t._handleRPCRequest(n,function(t,n){return t?r(t):e(n)})})}}(this)}return t.prototype.setRPCHandler=function(t){this._handleRPCRequest=t},t.prototype.publish=function(){var t,n,e,r,i,o,s;return n=arguments[0],o=3<=arguments.length?c.call(arguments,1,s=arguments.length-1):(s=1,[]),i=arguments[s++],e=o[0],t=o[1],r=u(n,e,t),a.publish(r,i,function(){})},t}(),e.exports.endpoint=new i,r=function(){function t(){}return t.prototype.rpc=function(t,n){if(!s)throw new Error("No Remote Endpoint available for in memory client");return s(t).then(function(t){return n(null,t)})["catch"](function(t){return n(t)})},t.prototype.subscribe=function(){var t,n,e,r,i,o,s;return n=arguments[0],o=3<=arguments.length?c.call(arguments,1,s=arguments.length-1):(s=1,[]),i=arguments[s++],e=o[0],t=o[1],r=u(n,e,t),a.subscribe(r,i)},t.prototype.unsubscribe=function(t){return a.unsubscribe(t)},t}(),e.exports.client=new r,u=function(t,n,e){var r;return r=t,n&&(r+="/"+n),e&&(r+="/"+e),r}}),require.register("eventric/store/inmemory/index",function(t,n,e){e.exports=n("./store_inmemory")}),require.register("eventric/store/inmemory/store_inmemory",function(t,n,e){var r,i,o=[].slice;i=["domain_events","projections"],r=function(){function t(){}return t.prototype._domainEvents={},t.prototype._projections={},t.prototype.initialize=function(){var t,n,e;return e=arguments[0],n=2<=arguments.length?o.call(arguments,1):[],this._context=e,t=n[0],new Promise(function(t){return function(n){return t._domainEventsCollectionName=""+t._context.name+".DomainEvents",t._projectionCollectionName=""+t._context.name+".Projections",t._domainEvents[t._domainEventsCollectionName]=[],n()}}(this))},t.prototype.saveDomainEvent=function(t){return new Promise(function(n){return function(e){return n._domainEvents[n._domainEventsCollectionName].push(t),e(t)}}(this))},t.prototype.findAllDomainEvents=function(t){return t(null,this._domainEvents[this._domainEventsCollectionName])},t.prototype.findDomainEventsByName=function(t,n){var e,r;return e=t instanceof Array?function(n){return t.indexOf(n)>-1}:function(n){return n===t},r=this._domainEvents[this._domainEventsCollectionName].filter(function(t){return e(t.name)}),n(null,r)},t.prototype.findDomainEventsByNameAndAggregateId=function(t,n,e){var r,i,o;return i=t instanceof Array?function(n){return t.indexOf(n)>-1}:function(n){return n===t},r=n instanceof Array?function(t){return n.indexOf(t)>-1}:function(t){return t===n},o=this._domainEvents[this._domainEventsCollectionName].filter(function(t){var n;return i(t.name)&&r(null!=(n=t.aggregate)?n.id:void 0)}),e(null,o)},t.prototype.findDomainEventsByAggregateId=function(t,n){var e,r;return e=t instanceof Array?function(n){return t.indexOf(n)>-1}:function(n){return n===t},r=this._domainEvents[this._domainEventsCollectionName].filter(function(t){var n;return e(null!=(n=t.aggregate)?n.id:void 0)}),n(null,r)},t.prototype.findDomainEventsByAggregateName=function(t,n){var e,r;return e=t instanceof Array?function(n){return t.indexOf(n)>-1}:function(n){return n===t},r=this._domainEvents[this._domainEventsCollectionName].filter(function(t){var n;return e(null!=(n=t.aggregate)?n.name:void 0)}),n(null,r)},t.prototype.getProjectionStore=function(t){return new Promise(function(n){return function(e){var r,i,o;return null==(r=n._projections)[o=n._projectionCollectionName]&&(r[o]={}),null==(i=n._projections[n._projectionCollectionName])[t]&&(i[t]={}),e(n._projections[n._projectionCollectionName][t])}}(this))},t.prototype.clearProjectionStore=function(t){return new Promise(function(n){return function(e){var r,i,o;return null==(r=n._projections)[o=n._projectionCollectionName]&&(r[o]={}),null==(i=n._projections[n._projectionCollectionName])[t]&&(i[t]={}),delete n._projections[n._projectionCollectionName][t],e()}}(this))},t.prototype.checkSupport=function(t){return i.indexOf(t)>-1},t}(),e.exports=r});